
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Печать этикеток из поступления только отмеченной номенклатуры - 1C-developer</title>
  <meta name="author" content="Роман Беляев">

  
  <meta name="description" content="Попросил как то меня клиент, &#8220;А можно мне галочку в табличную часть документа поступления, что бы можно было печатать этикетки только у &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://developer1c.ru/blog/2012/09/23/piechat%27-etikietok-iz-postuplieniia-tol%27ko-otmiechiennoi-nomienklatury/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
   <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/1c_dev/atom.xml" rel="alternate" title="1C-developer" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34619019-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">1C-developer</a></h1>
  
    <h2>Блог о суровых реалиях тупого и жадного 1сника</h2>
  
</hgroup>

</header>
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/1c_dev/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:developer1c.ru" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav> -->
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Печать этикеток из поступления только отмеченной номенклатуры</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-23T20:53:00+11:00" pubdate data-updated="true">Sep 23<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Попросил как то меня клиент, &#8220;А можно мне галочку в табличную часть документа поступления, что бы можно было печатать этикетки только у определенной номенклатуры, а не для всех 2000 позиций которые пришли с этим поступлением?&#8221; Да не вопрос, 5 минут и готово! Ответил я и закатав рукава, приступил к работе, оказалость что я не учел несколько деталей&#8230;<!-- more --></p>

<h3>Что было упущено?</h3>

<p>Реквизит в табличную часть документа добавлять нельзя, так как установка флажка изменяет табличную часть, то форма получает признак модифицированности и постоянные вопросы о необходимости сохранять документ, немного нервируют пользователя(а если документ большой и проведенный, то процедура сохранения, еще и какое то время занимает) в целом это можно было бы и пережить(можно и признак модифицированности скидывать), но клиент мириться с этим не захотел, а так как если при печати все равно придется анализировать табличное поле, было решено сделать колонку не связанную с данными табличной части. В результате анализа ситуации стало ясно следующее:</p>

<ol>
<li><p>Если данные не хранятся в табличной части, то придется самому позаботится о том где мы будеи держать информацию об отмеченных строках.</p></li>
<li><p>Механизм отрисовки флажка тоже придется взять на себя.</p></li>
</ol>


<p>Как обычно прежде чем начинать городить велосипед, был сделан запрос к <a href="http://www.forum.mista.ru" title="миста">базе знаний</a> и выяснено следующее: для моего случая уже есть описанный случай на ИТС и называется он <code>Реализация отметки строк флажками в табличном поле</code>. Раз есть готовый код, то берем его, модифицируем, используем. Итак поехали:</p>

<h3>Реализация отметок в табличном поле</h3>

<p>Для начала, надо добавить колонку в табличное поле и нужно указать, что элемент управления - флажок, ну и название придумать какое нибудь. Теперь надо позаботится об объекте где будут храниться данные об наших отметках. Это будет переменная и называться она будет <code>СписокОтметок</code>, так и объявим в начале модуля:
<code>Перем СписокОтметок;</code>
в конце где выполняется код при открытии модуля (если не понимаете о чем я просто поставьте самой последней строкой) укажем тип нашей переменной: <code>СписокОтметок = Новый Соответствие</code>.</p>

<p>Теперь надо организовать изменение этого списка, когда пользователь щелкает по флажку в табличной части, для этого подойдет событие табличного поля <code>ПриИзмененииФлажка</code>, в нем нам надо указать следующее:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Процедура ТоварыПриИзмененииФлажка(Элемент, Колонка)
</span><span class='line'>  Если Колонка.Имя = "Отметка" Тогда
</span><span class='line'>      Если СписокОтметок[Элемент.ТекущаяСтрока] = Неопределено Тогда
</span><span class='line'>          СписокОтметок[Элемент.ТекущаяСтрока] = Истина;
</span><span class='line'>      Иначе
</span><span class='line'>          СписокОтметок.Удалить(Элемент.ТекущаяСтрока);
</span><span class='line'>      КонецЕсли;
</span><span class='line'>  КонецЕсли;
</span><span class='line'>КонецПроцедуры</span></code></pre></td></tr></table></div></figure>


<p>Что здесь происходит: когда пользователь щелкает по флажку, процедура ищет нужную строку табличной части и если ее нет, то добавляет, если есть удалет, таким образом, осуществляя изменение состояния флажка.</p>

<p>Теперь нужно организовать вывод флажков в табличное поле, на текущий момент юзер не видит установленных флажков в табличном поле. Для работы с выводом, нужно использовать событие <code>ПриВыводеСтроки</code> вот такой код используется для вывода флажка:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ОформлениеСтроки.Ячейки.Отметка.ОтображатьФлажок = Истина;
</span><span class='line'>Если СписокОтметок[ДанныеСтроки] = Неопределено Тогда
</span><span class='line'>  ОформлениеСтроки.Ячейки.Отметка.Флажок = Ложь;
</span><span class='line'>Иначе
</span><span class='line'>  ОформлениеСтроки.Ячейки.Отметка.Флажок = Истина;
</span><span class='line'>КонецЕсли;</span></code></pre></td></tr></table></div></figure>


<p>Тут все тоже очень просто: если текущая строка есть в списке отметок мы ее отметим если нету, не будем. Таким образом у нас есть список тех строк табличной части документов, которые были отмечены.</p>

<h3>Передача отмеченных строк в обработку печати этикеток</h3>

<p>Для того, что бы передать список номенклатуры, в обработку печати этикеток, я нашел два варианта, это передать ссылку на группу или ссылку на номенклатуру. Или что бы со списком было бы еще количество, можно передать ссылку на документ. Нам не подходит не первое, не второе. Так как нам нужно и количество и определенный список. Поэтому я немного переделал процедуру печати этикеток <code>НапечататьЭтикеткиИзДокумента</code>, которая формирует из ссылки на табличную часть документа, таблицу товары, которую принимает обработка печати этикеток. Для начала я выгрузил в таблицу значений отмеченные значения, загрузил ее во временную таблицу в запросе.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>МВТ = Новый МенеджерВременныхТаблиц;
</span><span class='line'>ТаблицаИзДока = Новый Запрос;
</span><span class='line'>ТаблицаИзДока.МенеджерВременныхТаблиц = МВТ;
</span><span class='line'>ТаблицаИзДока.Текст = 
</span><span class='line'>  "Выбрать
</span><span class='line'>  |Таблица.Номенклатура,
</span><span class='line'>  |Таблица.Количество,
</span><span class='line'>  |Таблица.ЕдиницаИзмерения,
</span><span class='line'>  |ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка) КАК Характеристика,
</span><span class='line'>  |ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка) КАК Серия,
</span><span class='line'>  |ЗНАЧЕНИЕ(Справочник.Качество.Новый) КАК Качество,
</span><span class='line'>  |0 КАК Цена
</span><span class='line'>  |ПОМЕСТИТЬ ТаблицаИЗДока
</span><span class='line'>  |ИЗ
</span><span class='line'>  |&ТаблицаСДанными КАК Таблица";
</span><span class='line'>ТаблицаИзДока.УстановитьПараметр("ТаблицаСДанными", ТабличкаИЗДокумента);
</span><span class='line'>ТаблицаИзДока.Выполнить();</span></code></pre></td></tr></table></div></figure>


<p>Полученную временную таблицу я передал в запрос, выбирающий данные из регистра штрихкодов:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Запрос = Новый Запрос;
</span><span class='line'>Запрос.МенеджерВременныхТаблиц = МВТ;
</span><span class='line'>Запрос.Текст =
</span><span class='line'>  "ВЫБРАТЬ
</span><span class='line'>  |   Док.Номенклатура КАК Номенклатура,
</span><span class='line'>  |   Док.Количество КАК Количество,
</span><span class='line'>  |   Док.Характеристика КАК Характеристика,
</span><span class='line'>  |   Док.Серия КАК Серия,
</span><span class='line'>  |   Док.Качество КАК Качество,
</span><span class='line'>  |   Док.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
</span><span class='line'>  |   Док.Цена КАК Цена,
</span><span class='line'>  |   РегШК.ТипШтрихкода КАК ТипШтрихкода,
</span><span class='line'>  |   РегШК.Штрихкод КАК Штрихкод
</span><span class='line'>  |ИЗ
</span><span class='line'>  |   ТаблицаИЗДока КАК Док
</span><span class='line'>  |       ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.Штрихкоды КАК РегШК
</span><span class='line'>  |       ПО (РегШК.Владелец = Док.Номенклатура)
</span><span class='line'>  |           И (РегШК.ЕдиницаИзмерения = Док.ЕдиницаИзмерения)
</span><span class='line'>  |           И (РегШК.ХарактеристикаНоменклатуры = Док.Характеристика)
</span><span class='line'>  |           И (РегШК.СерияНоменклатуры = Док.Серия)
</span><span class='line'>  |           И (РегШК.Качество = Док.Качество)";</span></code></pre></td></tr></table></div></figure>


<p>после этого остается только напечатать этикетки</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ЗаполнениеДокументов.ПечатьЭтикеток(Запрос.Выполнить().Выгрузить());</span></code></pre></td></tr></table></div></figure>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Автор <span class="fn">Роман Беляев</span></span>

      








  


<time datetime="2012-09-23T20:53:00+11:00" pubdate data-updated="true">Sep 23<span>rd</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/Разработка/'>Разработка</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://developer1c.ru/blog/2012/09/23/piechat%27-etikietok-iz-postuplieniia-tol%27ko-otmiechiennoi-nomienklatury/" data-via="belyaev_rs" data-counturl="http://developer1c.ru/blog/2012/09/23/piechat%27-etikietok-iz-postuplieniia-tol%27ko-otmiechiennoi-nomienklatury/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/09/19/lieto-zakonchilos%27-dot-dot-dot/" title="Previous Post: Лето закончилось...">&laquo; Лето закончилось...</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <div id="hypercomments_widget"></div>
  </section>
</div>

<aside class="sidebar">
  
    <section>
  <a href="http://developer1c.ru" title="На главную"><img src="http://developer1c.ru/images/Home.png" alt="На главную"></a>
  <a href="http://developer1c.ru/atom.xml" title="RSS"><img src="http://developer1c.ru/images/rss_big.png" alt="RSS"></a>
  <a href="mailto:belyaev.rs@gmail.com" title="Написать автору"><img src="http://developer1c.ru/images/Envelope.png" alt="Написать автору"></a>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/09/23/piechat%27-etikietok-iz-postuplieniia-tol%27ko-otmiechiennoi-nomienklatury/">Печать этикеток из поступления только отмеченной номенклатуры</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/19/lieto-zakonchilos%27-dot-dot-dot/">Лето закончилось...</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/18/podkliuchieniie-skaniera-shtrikhkodov-k-1s/">Подключение сканера штрихкодов к 1С</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/07/proghrammnoie-raspolozhieniie-eliemientov-na-formie/">Программное расположение элементов на форме</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/06/khranieniie-ostatkov-postavshchika-u-siebia-v-bazie/">Хранение остатков поставщика у себя в базе</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("belyaev_rs", 5, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/belyaev_rs" class="twitter-follow-button" data-show-count="false">Follow @belyaev_rs</a>
  
</section>


<section>
  <h1>Об авторе блога</h1>
  <p><img align="left" src="https://twimg0-a.akamaihd.net/profile_images/1407778606/IMG_0017_bigger.JPG">Меня зовут Беляев Роман. Я занимаюсь программированием в 1С и здесь записываю накопленный опыт.</p>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Роман Беляев -
  <span class="credit">Работает на <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<script type="text/javascript">
var _hcp = _hcp || {};_hcp.widget_id = 2839;_hcp.widget = "Stream";
(function() { 
var hcc = document.createElement("script"); hcc.type = "text/javascript"; hcc.async = true;
hcc.src = ("https:" == document.location.protocol ? "https" : "http")+"://widget.hypercomments.com/apps/js/hc.js";
var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hcc, s.nextSibling); 
})();
</script>


</body>
</html>
