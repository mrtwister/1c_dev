
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Основные моменты при работе с СКД - 1C-developer</title>
  <meta name="author" content="Роман Беляев">

  
  <meta name="description" content="В данном топике я хотел бы затронуть, некоторые моменты работы с СКД: работа с формой отчета, использование нескольких схем компоновки данных, работа &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mrtwister.github.com/1c_dev/blog/2012/09/05/osnovnyie-momienty-pri-rabotie-s-skd/">
  <link href="/1c_dev/favicon.png" rel="icon">
  <link href="/1c_dev/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
   <link href="/1c_dev/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/1c_dev/javascripts/modernizr-2.0.js"></script>
  <script src="/1c_dev/javascripts/ender.js"></script>
  <script src="/1c_dev/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/1c_dev/atom.xml" rel="alternate" title="1C-developer" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>


  

</head>

<body   >
  <header role="banner"><hgroup>
</hgroup>

</header>
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/1c_dev/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mrtwister.github.com/1c_dev" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/1c_dev/">Blog</a></li>
  <li><a href="/1c_dev/blog/archives">Archives</a></li>
</ul>

</nav> -->
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Основные моменты при работе с СКД</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-05T21:09:00+11:00" pubdate data-updated="true">Sep 5<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>В данном топике я хотел бы затронуть, некоторые моменты работы с СКД: работа с формой отчета, использование нескольких схем компоновки данных, работа с параметрами и так по мелочи, что накопилось за время использования СКД. Итак:<!-- more --></p>

<h2>Как использовать параметры в СКД?</h2>

<p>При написании отчета для СКД иногда возникает потребность в использовании параметров, какие есть варианты? Для начала надо определиться что для того что бы параметры стали доступными, необходимо поставить галочку в схеме вот здесь:
<img src="http://i.minus.com/ierRVE7WtSai1.png"></p>

<ol>
<li>Тыкнуть по кнопочке настройки, и задать настройки на стандартной форме. Мы этот вариант даже рассматривать не будем, по той простой причине, что их видно на стандартной форме невооруженным глазом, достаточно тыкнуть на кнопку&#8230; Настройки конечно же.</li>
<li>Сделать таблицу на форме и указать у нее источник.</li>
<li>Добавить на форму отчета поля ввода и прописать изменение параметров СКД при их изменении</li>
</ol>


<p>Рассмотрим  все варианты по подробнее.</p>

<h3>2. Вывод всех прописанных настроек в одной таблице</h3>

<p>Это делается очень просто, добавляется таблица значений на форму а источником данных нужно указать: ОтчетОбъект -> КомпоновщикНастроек -> Настройки -> Параметры данных.</p>

<h3>3. Вынесение параметров отчета на форму, как правило самый нужный и удобный метод установки параметров.</h3>

<p>Для этого создадим форму отчета, если вы ее еще не создали (куда то, нам надо вынести параметры которые мы будем передавать в СКД) и добавим поле ввода нужного нам типа. И в событии &#8220;ПриИзменении&#8221; укажем следующий код:</p>

<figure class='code'><figcaption><span>ПриИзменении </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Параметры = КомпоновщикНастроек.Настройки.ПараметрыДанных;
</span><span class='line'>Параметр = Параметры.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("ПараметрУказанныйВЗапросе"));
</span><span class='line'>Если Параметр &lt;> Неопределено Тогда
</span><span class='line'>  Параметр.Значение = ЗначениеКотороеМыХотимУстановить;
</span><span class='line'>  Параметр.Использование = Истина;
</span><span class='line'>КонецЕсли;</span></code></pre></td></tr></table></div></figure>


<p>Готово! Теперь при изменении элемента на форме параметр будет автоматически загружаться в СКД.</p>

<h2>Использование нескольких схем</h2>

<p>Периодически бывает что один отчет должен показывать вроде бы одну и ту же информацию но в разрезе разных показателей и вроде отчет тот же, только сменился тип аналитики, или убрали колонку, которая участвовала в расчетах, так он для пользователя тот же для разработчика уже другой набор полей и уже скорее всего структура другая, вообщем необходимо делать другой отчет, но можно просто использовать несколько схем и переключаться между ними по мере надобности. Переключаться между схемами несложно, достаточно сделать кнопочку повешать на нее следующую процедуру:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Процедура СменитьСхему()
</span><span class='line'>  СхемаКомпоновкиДанных = ПолучитьМакет("ЗдесьНадоУказатьИмяСхемы");
</span><span class='line'>  Настройки = СхемаКомпоновкиДанных.НастройкиПоУмолчанию;
</span><span class='line'>  КомпоновщикНастроек.ЗагрузитьНастройки(Настройки);
</span><span class='line'>КонецПроцедуры</span></code></pre></td></tr></table></div></figure>


<p>Как видите, все просто, при желании можно сократить до двух строк или даже одной, но не уверен, что это пойдет на пользу читаемости кода. Но тут есть свой нюанс, при загрузке новых настроек старые параметры сотрутся, что на самом деле логично, но нас такое положение дел совершенно не устраивает. Какой из этого есть выход, я думаю надо перед сменой компоновки параметры надо сохранить в какой то буфер, а потом их восстановить. Как получить\записать параметр я уже говорил выше и не буду на это останавливаться. Так как параметров как правило больше чем два, особенно если это сложный отчет, то неправильно будет, писать</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Параметр1 = Параметры.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("ПараметрУказанныйВЗапросе"));
</span><span class='line'>Параметр1.Значение = ЗначениеКотороеМыХотимУстановить;
</span><span class='line'>Параметр1.Использование = Истина;
</span><span class='line'>
</span><span class='line'>Параметр2 = Параметры.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("ПараметрУказанныйВЗапросе2"));
</span><span class='line'>Параметр2.Значение = ЗначениеКотороеМыХотимУстановить;
</span><span class='line'>Параметр2.Использование = Истина;
</span><span class='line'>//и тд</span></code></pre></td></tr></table></div></figure>


<p>Надо бы указать: СохраниСписокПараметров(&#8220;ЗдесьСписокПараметров&#8221;); Для этого я напишу две процедуры, одна будет сохранять параметры в спецально для этого отведнную структуру, другая будет из нее восстанавливать параметры. Вот они:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Функция СохранитьПараметры(ИменаПараметров)
</span><span class='line'>  Параметры = КомпоновщикНастроек.Настройки.ПараметрыДанных;
</span><span class='line'>  МассивСИменами = ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок(ИменаПараметров,",");
</span><span class='line'>  СтруктураДляПараметров = Новый Структура;
</span><span class='line'>  Для Каждого ИмяПараметра Из МассивСИменами Цикл
</span><span class='line'>      Параметр = Параметры.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных(ИмяПараметра));
</span><span class='line'>      Если Параметр &lt;> Неопределено Тогда
</span><span class='line'>          СтруктураДляПараметров.Вставить(ИмяПараметра, Параметр.Значение);
</span><span class='line'>      КонецЕсли; 
</span><span class='line'>  КонецЦикла;   
</span><span class='line'>  
</span><span class='line'>  Возврат СтруктураДляПараметров;
</span><span class='line'>КонецФункции
</span><span class='line'>
</span><span class='line'>Процедура ЗагрузитьПараметры(СтруктураСПараметрами)
</span><span class='line'>  Параметры = КомпоновщикНастроек.Настройки.ПараметрыДанных;
</span><span class='line'>    Для Каждого ТекущийПараметр Из СтруктураСПараметрами Цикл
</span><span class='line'>      Параметр = Параметры.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных(ТекущийПараметр.Ключ));
</span><span class='line'>      Если Параметр &lt;> Неопределено Тогда
</span><span class='line'>          Параметр.Значение = ТекущийПараметр.Значение;
</span><span class='line'>          Параметр.Использование = Истина;
</span><span class='line'>      КонецЕсли; 
</span><span class='line'>  КонецЦикла;   
</span><span class='line'>КонецПроцедуры</span></code></pre></td></tr></table></div></figure>


<p>Остановлюсь, что бы более подробно объяснить, что происходит. Функция СохранитьПараметры принимает на входе строку с именами тех параметров которые надо сохранить. Затем в строке??? она находит по имени нужный параметр и сохраняет в структуру, которую возвращает по окончании перебора всех параметров полученых из строки. То же самое, только наоборот делает процедура загрузить, она принимает структуру и загружает из нее в СКД параметры. Далее надо собрать все вместе, выглядеть это будет примерно так:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Функция СохранитьПараметры(ИменаПараметров)
</span><span class='line'>  Параметры = КомпоновщикНастроек.Настройки.ПараметрыДанных;
</span><span class='line'>  МассивСИменами = ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок(ИменаПараметров,",");
</span><span class='line'>  СтруктураДляПараметров = Новый Структура;
</span><span class='line'>  Для Каждого ИмяПараметра Из МассивСИменами Цикл
</span><span class='line'>      Параметр = Параметры.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных(ИмяПараметра));
</span><span class='line'>      Если Параметр &lt;> Неопределено Тогда
</span><span class='line'>          СтруктураДляПараметров.Вставить(ИмяПараметра, Параметр.Значение);
</span><span class='line'>      КонецЕсли; 
</span><span class='line'>  КонецЦикла;   
</span><span class='line'>  
</span><span class='line'>  Возврат СтруктураДляПараметров;
</span><span class='line'>КонецФункции
</span><span class='line'>
</span><span class='line'>Процедура ЗагрузитьПараметры(СтруктураСПараметрами)
</span><span class='line'>  Параметры = КомпоновщикНастроек.Настройки.ПараметрыДанных;
</span><span class='line'>    Для Каждого ТекущийПараметр Из СтруктураСПараметрами Цикл
</span><span class='line'>      Параметр = Параметры.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных(ТекущийПараметр.Ключ));
</span><span class='line'>      Если Параметр &lt;> Неопределено Тогда
</span><span class='line'>          Параметр.Значение = ТекущийПараметр.Значение;
</span><span class='line'>          Параметр.Использование = Истина;
</span><span class='line'>      КонецЕсли; 
</span><span class='line'>  КонецЦикла;   
</span><span class='line'>КонецПроцедуры
</span><span class='line'> 
</span><span class='line'>Процедура СменитьСхему()
</span><span class='line'>  СтруктураСНастройками = СохранитьПараметры("Заказ,НашСклад,СкладПоставщика");
</span><span class='line'>  СхемаКомпоновкиДанных = ПолучитьМакет("ЗдесьИмяНужнойВамСхемы");
</span><span class='line'>  Настройки = СхемаКомпоновкиДанных.НастройкиПоУмолчанию;
</span><span class='line'>  КомпоновщикНастроек.ЗагрузитьНастройки(Настройки);
</span><span class='line'>  ЗагрузитьПараметры(СтруктураСНастройками);
</span><span class='line'>КонецПроцедуры</span></code></pre></td></tr></table></div></figure>


<h2>Вывод СКД в отчет</h2>

<p>Если вы создали форму отчета у СКД(то есть если у вас отчет и есть схема компоновки данных), то по умолчанию на кнопке &#8220;Сформировать&#8221; висит предустанновленная команда сфрмировать, которая запустит текущую схему но можно туда повесить свой обработчик, если нужно перед формирование сделать какие нибудь манипуляции, вот код который можно туда повесить:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>КомпоновщикМакета=Новый КомпоновщикМакетаКомпоновкиДанных;
</span><span class='line'>МакетКомпоновкиДанных=КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных,КомпоновщикНастроек.Настройки,ДанныеРасшифровки);
</span><span class='line'>ПроцессорКомпоновкиДанных=Новый ПроцессорКомпоновкиДанных;
</span><span class='line'>ПроцессорКомпоновкиДанных.Инициализировать(МакетКомпоновкиДанных,,ДанныеРасшифровки,Истина);
</span><span class='line'>ПроцессорВывода=Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
</span><span class='line'>ПроцессорВывода.УстановитьДокумент(ЭлементыФормы.Результат);
</span><span class='line'>ПроцессорВывода.Вывести(ПроцессорКомпоновкиДанных);</span></code></pre></td></tr></table></div></figure>


<p>например перед формированием отчета, можно установить заголовок, в зависимости от установленных параметров или свернуть группировки после формирования, или время там формирования засечь, всякое бывает. В целом можно вывести разом, а можно управлять выводом, посмотреть детали можно в синтаксис помощнике по адресу Общие объекты -> Система компоновки данных -> Работа с механизмом -> ПроцессорВыводаРезультатаКомпоновкиДанных</p>

<h3>Вывод СКД в таблицу.</h3>

<p>Бывает нужен, если нужно проанализировать или что то сделать с результатами работы, что бы получить результат работы  СКД в таблицу значений или в дерево значений, вам поможет следующий код:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>КомпоновщикМакета=Новый КомпоновщикМакетаКомпоновкиДанных;
</span><span class='line'>МакетКомпоновкиДанных=КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных,КомпоновщикНастроек.Настройки,,,Тип("ГенераторМакетаКомпоновкиДанныхДляКоллекцииЗначений"));
</span><span class='line'>ПроцессорКомпоновкиДанных=Новый ПроцессорКомпоновкиДанных;
</span><span class='line'>ПроцессорКомпоновкиДанных.Инициализировать(МакетКомпоновкиДанных);
</span><span class='line'>  
</span><span class='line'>ТЗДляВывода = Новый ТаблицаЗначений;//здесь может быть и дерево значений
</span><span class='line'>ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВКоллекциюЗначений;
</span><span class='line'>ПроцессорВывода.УстановитьОбъект(ТЗДляВывода);
</span><span class='line'>ПроцессорВывода.Вывести(ПроцессорКомпоновкиДанных);</span></code></pre></td></tr></table></div></figure>


<p>собственно здесь в ТЗДляВывода мы получаем результат формирования отчета. Собственно если не касаться непосредствнно самого СКД, то здесь описаны практически все моменты работы с формой отчета построенного на СКД.</p>

<h3>Бонусы</h3>

<p>Тому кто домучал до конца эту длинную повесть, пригодятся бонусы:
Курс от гилева про СКД, что бы не искать информацию про СКД, можно скачать <a href="http://www.spec8.ru/kurs-po-skd-besplatno">бесплатный курс по СКД</a>
Можно взять <a href="http://i.minus.com/1346925743/KFYgeBupj_IIWeO5NdHyuQ/dp9PtAJ9c62Sh/%D0%A8%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD.erf">шаблон, в котором есть все нужные для оформления фичи</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Роман Беляев</span></span>

      








  


<time datetime="2012-09-05T21:09:00+11:00" pubdate data-updated="true">Sep 5<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/1c_dev/blog/categories/СКД/'>СКД</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://mrtwister.github.com/1c_dev/blog/2012/09/05/osnovnyie-momienty-pri-rabotie-s-skd/" data-via="" data-counturl="http://mrtwister.github.com/1c_dev/blog/2012/09/05/osnovnyie-momienty-pri-rabotie-s-skd/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/1c_dev/blog/2012/09/04/skd-paramietry/" title="Previous Post: Основные моменты при работе с СКД">&laquo; Основные моменты при работе с СКД</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/1c_dev/blog/2012/09/05/osnovnyie-momienty-pri-rabotie-s-skd/">Основные моменты при работе с СКД</a>
      </li>
    
      <li class="post">
        <a href="/1c_dev/blog/2012/09/04/skd-paramietry/">Основные моменты при работе с СКД</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Роман Беляев -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
