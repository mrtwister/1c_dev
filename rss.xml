<?xml version="1.0" encoding="UTF-8"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title><![CDATA[Разработчик 1C]]></title>
        <description><![CDATA[Разработчик 1C]]></description>
        <link>http://localhost:9778</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Fri, 20 Mar 2015 11:58:22 GMT</lastBuildDate>
        <atom:link href="http://localhost:9778/rss.xml" rel="self" type="application/rss+xml"/>
        <pubDate>Fri, 20 Mar 2015 11:58:17 GMT</pubDate>
        <item>
            <title><![CDATA[Срез последних регистра сведений на каждую дату, подробно.]]></title>
            <description><![CDATA[<p>Виртуальные таблицы у регистров очень полезная и удобная штука, но иногда вдруг оказывается, что им категорически не хватает какого то функционала. Что моментально ставит в тупик человека который познакомился в запросами в конструкторе запросов. Например классическая задача &quot;срез последних на каждую дату&quot;.</p>
<h3 id="-">Задача</h3>
<p>Есть список номенклатуры. Как мы получили этот список не так важно, важно, что он у нас есть. Необходимо, по пунктам:</p>
<ol>
<li>Получить список продаж для каждой позиции номенклатуры, который будет включать в себя:<ul>
<li>Дату продажи.</li>
<li>Сумму продажи.</li>
<li>Количество.</li>
</ul>
</li>
<li>На каждую дату продажи получить закупочную цены этой самой номенклатуры из регистра сведений &quot;Цены номенклатуры&quot;.</li>
<li>Проведя простые математические операции выяснить:<ul>
<li>Сумму в закупке проданной номенклатуры.</li>
<li>Сумму продаж(уже получено в п.1).</li>
<li>Прибыль по каждой конкретно взятой номенклатуре.</li>
</ul>
</li>
</ol>
<h3 id="-">Зачем вы изобретаете велосипед?</h3>
<p>Следует отметить, что пример учебный и информацию о прибыли для нужной номенклатуры можно легко получить из отчетов которые уже есть в типовой конфигурации. Но сам по себе отчет очень ярко показывает саму идею обозначенную в заголовке. А реализацию используйте как вам удобно.</p>
<h3 id="-">Суть реализации</h3>
<p>Так как мы говорим об запросах, то как такового кода здесь не будет, будут только схемы и тексты запросов с демонстрацией ожидаемого результата. Техническая сторона вопроса подробно описана <a href="http://kb.mista.ru/article.php?id=92" title="книга знаний мисты">здесь</a> собственно на этом можно и закончить. Если вы прочитали статью и у вас не осталось вопросов, дальше можно не читать. Если вам сложно понять мысль написанную там, давайте продолжим. Идея заключается в соединении таблицы регистра сведений с самой собой. Для реализации нам понадобится таблица с датами, этой таблицей у нас будет таблица продаж. Вот простой запрос, выбирающий продажи, которые мы положим во временную таблицу, я развернул периодичность до секунд так, что в целом я думаю, можно было и не пользоваться виртуальной таблицей, но ее использование в СКД, дало мне возможность, в случае необходимости ограничить продажи интервалом дат, не трогая запрос.</p>
<pre>ВЫБРАТЬ
    ПродажиОбороты.Номенклатура,
    ПродажиОбороты.Период,
    ПродажиОбороты.КоличествоОборот,
    ПродажиОбороты.СтоимостьОборот
ПОМЕСТИТЬ Продажи
ИЗ
    РегистрНакопления.Продажи.Обороты(, , Секунда, Номенклатура В (&СписокНоменклатуры)) КАК ПродажиОбороты`
</pre>
Получаем что то подобное:
<table class="table table-bordered">
<tr><th>Номенклатура</th><th>Период</th><th>КоличествоОборот</th><th>СтоимостьОборот</th></tr>
 <tr><td>Товар3</td><td>16.09 19:01:54</td><td>1</td><td>180</td></tr>
 <tr><td>Товар3</td><td>20.09 19:00:44</td><td>1</td><td>180</td></tr>
 <tr><td>Товар2</td><td>21.09 16:57:28</td><td>1</td><td>270</td></tr>
 <tr><td>Товар2</td><td>22.09 18:57:37</td><td>1</td><td>270</td></tr>
 <tr><td>Товар3</td><td>23.09 18:57:36</td><td>1</td><td>170</td></tr>
 <tr><td>Товар1</td><td>24.09 18:56:35</td><td>1</td><td>540</td></tr>
 <tr><td>Товар2</td><td>25.09 19:00:51</td><td>1</td><td>270</td></tr>
 <tr><td>Товар2</td><td>26.09 19:00:39</td><td>1</td><td>270</td></tr>
 <tr><td>Товар3</td><td>27.09 18:59:15</td><td>1</td><td>170</td></tr>
 <tr><td>Товар2</td><td>29.09 11:16:32</td><td>3</td><td>579,03</td></tr></table>
Положим его во временную таблицу, он нам пригодится еще не раз. Теперь наша задача получить последнюю дату из регистра для каждой номенклатуры. Для этого добавляем еще один пакет запроса в конструкторе и в новом запросе делаем вложенный запрос, в котором соединяем нашу таблицу продаж и регистр сведений внутренним соединением по номенклатуре и периоду. Соединение по периоду должно быть `<=` то есть нам нужны **все** записи регистра цен для каждой номенклатуры у которой дата меньше или равно даты продажи конкретной номенклатуры. Выглядеть, это должно приблизительно таким образом:

<pre>
ВЫБРАТЬ
        Продажи.Номенклатура КАК Номенклатура,
        МАКСИМУМ(ЦеныНоменклатуры.Период) КАК Период,
        Продажи.Период КАК ПериодПродажа
    ИЗ
        Продажи КАК Продажи
            ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры
            ПО Продажи.Номенклатура = ЦеныНоменклатуры.Номенклатура
                И Продажи.Период >= ЦеныНоменклатуры.Период
    ГДЕ
        ЦеныНоменклатуры.ТипЦен = &ЗакупочныйТипЦен

    СГРУППИРОВАТЬ ПО
        Продажи.Номенклатура,
        Продажи.Период
</pre>

<p>Обратите внимание, мы группируем записи регистра сведений, получая максимальное значение даты из регистра. Выбираем все. а забираем только последнее. Логика следующая, вот результат запроса до группировки:</p>
<table class="table table-bordered">
<tr><th>Номенклатура</th><th>Период</th><th>Период продажа</th></tr>
<tr><td>Товар1</td><td>06.09</td><td>05.10 16:58:34</td></tr>
 <tr><td>Товар1</td><td>01.10</td><td>05.10 16:58:34</td></tr>
 <tr><td>Товар2</td><td>06.09</td><td>05.10 16:58:34</td></tr>
 <tr><td>Товар2</td><td>01.10</td><td>05.10 16:58:34</td></tr>
 <tr><td>Товар3</td><td>29.08</td><td>05.10 16:58:34</td></tr>
 <tr><td>Товар3</td><td>01.10</td><td>05.10 16:58:34</td></tr>
 <tr><td>Товар1</td><td>06.09</td><td>07.10 18:57:25</td></tr>
 <tr><td>Товар1</td><td>01.10</td><td>07.10 18:57:25</td></tr>
 <tr><td>Товар3</td><td>29.08</td><td>09.10 18:56:38</td></tr>
 <tr><td>Товар3</td><td>01.10</td><td>09.10 18:56:38</td></tr>
 <tr><td>Товар1</td><td>06.09</td><td>13.10 19:00:27</td></tr>
 <tr><td>Товар1</td><td>01.10</td><td>13.10 19:00:27</td></tr>
</table>

<p>То есть мы видим что есть несколько дат в регистре на каждую продажу, свернем это дело взяв самые последние записи для каждой продажи.</p>
<table class="table table-bordered">
<tr><th>Номенклатура</th><th>Период</th><th>Период продажа</th></tr>
 <tr><td>Товар1</td><td>01.10</td><td>05.10 16:58:34</td></tr>
 <tr><td>Товар2</td><td>01.10</td><td>05.10 16:58:34</td></tr>
 <tr><td>Товар3</td><td>01.10</td><td>05.10 16:58:34</td></tr>
 <tr><td>Товар1</td><td>01.10</td><td>07.10 18:57:25</td></tr>
 <tr><td>Товар3</td><td>01.10</td><td>09.10 18:56:38</td></tr>
 <tr><td>Товар1</td><td>01.10</td><td>13.10 19:00:27</td></tr>
</table>

<p>В результате мы получили одну запись на каждую продажу(если на дату продажи, было значение в регистре)</p>
<h3 id="-">Связываем таблицу дат с регистром.</h3>
<p>Теперь пришло время сделать то, ради чего было затеяно столько подготовительных действий. Мы сделаем внутреннее соединение регистра с результатом вложенного запроса(результат запроса, записи из этого же регистра) по номенклатуре и периоду и как следствие сможем получить цену для каждой даты продажи. Суть заключается в том, что у нас в регистре может быть только одна запись с таким периодом и номенклатурой как в результате вложенного запроса. И она там точно есть(мы же данные получили из этого регистра). Вот как выглядит запрос в сборе.</p>
<pre>
ВЫБРАТЬ
    ПродажиОбороты.Номенклатура,
    ПродажиОбороты.Период,
    ПродажиОбороты.КоличествоОборот,
    ПродажиОбороты.СтоимостьОборот
ПОМЕСТИТЬ Продажи
ИЗ
    РегистрНакопления.Продажи.Обороты(, , Секунда, Номенклатура В (&СписокНоменклатуры)) КАК ПродажиОбороты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
    ТаблицаЦен.Номенклатура,
    ТаблицаЦен.ПериодПродажа КАК Период,
    ЦеныНоменклатуры.Цена
ПОМЕСТИТЬ ЦеныПериоды
ИЗ
    (ВЫБРАТЬ
        Продажи.Номенклатура КАК Номенклатура,
        МАКСИМУМ(ЦеныНоменклатуры.Период) КАК Период,
        Продажи.Период КАК ПериодПродажа
    ИЗ
        Продажи КАК Продажи
            ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры
            ПО Продажи.Номенклатура = ЦеныНоменклатуры.Номенклатура
                И Продажи.Период >= ЦеныНоменклатуры.Период
    ГДЕ
        ЦеныНоменклатуры.ТипЦен = &ЗакупочныйТипЦен

    СГРУППИРОВАТЬ ПО
        Продажи.Номенклатура,
        Продажи.Период) КАК ТаблицаЦен
        ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры
        ПО ТаблицаЦен.Номенклатура = ЦеныНоменклатуры.Номенклатура
            И ТаблицаЦен.Период = ЦеныНоменклатуры.Период
ГДЕ
    ЦеныНоменклатуры.ТипЦен = &ЗакупочныйТипЦен
</pre>

<p>Помещаем результат в таблицу <code>ЦеныПериоды</code> и собственно у нас почти все готово. Теперь у нас есть таблица, в которой на каждую дату продажи лежит дата закупки. Соединяем таблицу продажи с таблицей <code>ЦеныПериоды</code> левым соединением, вычесть, сложить умножить и получить нужные поля, проблемы составить не должно. Последний штрих: если продажа и закупка были по одной цене и их было 10 нет смысла выводить каждую позицию, сгруппируем таблицу продаж по полю период с функцией &quot;Максимум&quot;. Если нужно знать сколько продаж сгруппировалось в строке, можно еще раз сгруппировать это же поле с функцией &quot;Количество различных&quot;. И так вот итоговый запрос:</p>
<pre>
ВЫБРАТЬ
    ПродажиОбороты.Номенклатура,
    ПродажиОбороты.Период,
    ПродажиОбороты.КоличествоОборот,
    ПродажиОбороты.СтоимостьОборот
ПОМЕСТИТЬ Продажи
ИЗ
    РегистрНакопления.Продажи.Обороты(, , Секунда, Номенклатура В (&СписокНоменклатуры)) КАК ПродажиОбороты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
    ТаблицаЦен.Номенклатура,
    ТаблицаЦен.ПериодПродажа КАК Период,
    ЦеныНоменклатуры.Цена
ПОМЕСТИТЬ ЦеныПериоды
ИЗ
    (ВЫБРАТЬ
        Продажи.Номенклатура КАК Номенклатура,
        МАКСИМУМ(ЦеныНоменклатуры.Период) КАК Период,
        Продажи.Период КАК ПериодПродажа
    ИЗ
        Продажи КАК Продажи
            ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры
            ПО Продажи.Номенклатура = ЦеныНоменклатуры.Номенклатура
                И Продажи.Период >= ЦеныНоменклатуры.Период
    ГДЕ
        ЦеныНоменклатуры.ТипЦен = &ЗакупочныйТипЦен

    СГРУППИРОВАТЬ ПО
        Продажи.Номенклатура,
        Продажи.Период) КАК ТаблицаЦен
        ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры
        ПО ТаблицаЦен.Номенклатура = ЦеныНоменклатуры.Номенклатура
            И ТаблицаЦен.Период = ЦеныНоменклатуры.Период
ГДЕ
    ЦеныНоменклатуры.ТипЦен = &ЗакупочныйТипЦен
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
    Продажи.Номенклатура,
    МАКСИМУМ(Продажи.Период) КАК Период,
    СУММА(Продажи.КоличествоОборот) КАК Количество,
    ЦеныПериоды.Цена КАК ЦенаЗакупки,
    СУММА(ЦеныПериоды.Цена * Продажи.КоличествоОборот) КАК СтоимостьЗакупки,
    ВЫБОР
        КОГДА Продажи.КоличествоОборот = 0
            ТОГДА 0
        ИНАЧЕ Продажи.СтоимостьОборот / Продажи.КоличествоОборот
    КОНЕЦ КАК ЦенаПродажи,
    СУММА(Продажи.СтоимостьОборот) КАК СтоимостьПродажи,
    СУММА(Продажи.СтоимостьОборот - ЦеныПериоды.Цена * Продажи.КоличествоОборот) КАК Прибыль,
    КОЛИЧЕСТВО(РАЗЛИЧНЫЕ Продажи.Период) КАК КоличествоПродаж
ИЗ
    Продажи КАК Продажи
        ЛЕВОЕ СОЕДИНЕНИЕ ЦеныПериоды КАК ЦеныПериоды
        ПО Продажи.Номенклатура = ЦеныПериоды.Номенклатура
            И Продажи.Период = ЦеныПериоды.Период

СГРУППИРОВАТЬ ПО
    Продажи.Номенклатура,
    ЦеныПериоды.Цена,
    ВЫБОР
        КОГДА Продажи.КоличествоОборот = 0
            ТОГДА 0
        ИНАЧЕ Продажи.СтоимостьОборот / Продажи.КоличествоОборот
    КОНЕЦ
</pre>

<p>Вот результат его работы если его положить в СКД:
<img src="http://i.imgur.com/LTagxy5.png" alt="Скрин"></p>
]]></description>
            <link>http://localhost:9778/posts/009_SliceLast</link>
            <guid isPermaLink="true">http://localhost:9778/posts/009_SliceLast</guid>
            <pubDate>Mon, 19 Jan 2015 13:21:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Запуск проекта 1с-wiki.]]></title>
            <description><![CDATA[<h3 id="-">Запуск проекта</h3>
<p>Мною с нуля написана wiki в которой описано большое количество материала нужного для работы с 1С. Был пройден достаточно большой пусть. Много изучено материалов и много написано кода и текста. Сайт запущен в формате wiki, это означает, что редактировать его может каждый, кому это интересно. </p>
<ul>
<li>Если вы начинающий разработчик и вам нужна структурированная информация о разработке в 1С</li>
<li>Если вы профессионал и вам есть, что сказать сообществу</li>
<li>Если вы хотите сделать этот мир чуть более документированным</li>
</ul>
<p><a href="http://wiki-1c.ru/">Добро пожаловать!</a></p>
<p>Хочется верить, что большие усилия, затраченные на написание статей, не пропадут впустую, а пригодятся нашему 1С-сообществу. Добро пожаловать! :)</p>
]]></description>
            <link>http://localhost:9778/posts/008_start_wiki</link>
            <guid isPermaLink="true">http://localhost:9778/posts/008_start_wiki</guid>
            <pubDate>Sun, 28 Dec 2014 13:07:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Анализ списка инвентаризаций одним махом.]]></title>
            <description><![CDATA[<h3 id="-">Постановка задачи</h3>
<p>После того как мы сделали ряд инвентаризаций и по результатам ввели документы, оказалось, что найти документ какую то конкретную инвентаризацию, что бы потом быстро что то поправить, в оприходованиях или списаниях целая задача. Было решено набросать набросать обработку которая будет:</p>
<ul>
<li>показывать все инвентаризации</li>
<li>документы которые введены на ее основании</li>
<li>номенклатуру остаток которой был исправлен этими документами.
При двойном щелчке по документу получаем сам документ, двойном щелчке по номенклатуре получаем историю движению по регистру хранения остатков. Цели ясны, задачи определены, приступаем.</li>
</ul>
<h3 id="-">Получение нужных данных.</h3>
<p>Вот сам запрос:</p>
<pre><p style="text-align: left; font-family: courier new,courier; color: black">
<font color=blue>ВЫБРАТЬ<br>
&nbsp; &nbsp; </font>ОприходованиеТоваров.<font color=brown>Ссылка </font><font color=blue>КАК </font><font color=brown>Ссылка</font><font color=blue>,<br>
&nbsp; &nbsp; </font>ОприходованиеТоваров.ИнвентаризацияТоваровНаСкладе <font color=blue>КАК </font>ИнвентаризацияТоваровНаСкладе<font color=blue>,<br>
&nbsp; &nbsp; </font>ОприходованиеТоваров.ИнвентаризацияТоваровНаСкладе.Дата <font color=blue>КАК </font>ИнвентаризацияТоваровНаСкладеДата<br>
<font color=blue>ИЗ<br>
&nbsp; &nbsp; </font>Документ.ОприходованиеТоваров <font color=blue>КАК </font>ОприходованиеТоваров<br>
<br>
<font color=blue>ОБЪЕДИНИТЬ ВСЕ<br>
<br>
ВЫБРАТЬ<br>
&nbsp; &nbsp; </font>СписаниеТоваров.Ссылка<font color=blue>,<br>
&nbsp; &nbsp; </font>СписаниеТоваров.ИнвентаризацияТоваровНаСкладе<font color=blue>,<br>
&nbsp; &nbsp; </font>СписаниеТоваров.ИнвентаризацияТоваровНаСкладе.Дата<br>
<font color=blue>ИЗ<br>
&nbsp; &nbsp; </font>Документ.СписаниеТоваров <font color=blue>КАК </font>СписаниеТоваров<br>
<br>
<font color=blue>УПОРЯДОЧИТЬ ПО<br>
&nbsp; &nbsp; </font>ИнвентаризацияТоваровНаСкладеДата <font color=blue>УБЫВ<br>
ИТОГИ ПО<br>
&nbsp; &nbsp; </font>ИнвентаризацияТоваровНаСкладе</p></pre>

<p>Далее мы выполняем запрос и обходим его по группировкам.</p>
<p><pre><p>
Выборка <font color=red>= </font>Запрос<font color=red>.</font>Выполнить<font color=red>().</font>Выбрать<font color=red>(</font>ОбходРезультатаЗапроса<font color=red>.</font>ПоГруппировкам<font color=red>);<br>
Пока </font>Выборка<font color=red>.</font>Следующий<font color=red>() Цикл<br>
&nbsp; &nbsp; </font>СтрокаИнвентаризация <font color=red>= </font>СписокДокументов<font color=red>.</font>Строки<font color=red>.</font>Добавить<font color=red>();<br>
&nbsp; &nbsp; </font>СтрокаИнвентаризация<font color=red>.</font>Док <font color=red>= </font>Выборка<font color=red>.</font>ИнвентаризацияТоваровНаСкладе<font color=red>;<br>
&nbsp; &nbsp; </font>СтрокаИнвентаризация<font color=red>.</font>Картинко <font color=red>= ?(</font>СтрокаИнвентаризация<font color=red>.</font>Док<font color=red>.</font>Проведен<font color=red>, </font><font color=black>1</font><font color=red>, ?(</font>СтрокаИнвентаризация<font color=red>.</font>Док<font color=red>.</font>ПометкаУдаления<font color=red>, </font><font color=black>2</font><font color=red>, </font><font color=black>0</font><font color=red>));<br>
<br>
&nbsp; &nbsp; </font>СкладскиеДокументы <font color=red>= </font>Выборка<font color=red>.</font>Выбрать<font color=red>();<br>
&nbsp; &nbsp; Пока </font>СкладскиеДокументы<font color=red>.</font>Следующий<font color=red>() Цикл<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтрокаСклад <font color=red>= </font>СтрокаИнвентаризация<font color=red>.</font>Строки<font color=red>.</font>Добавить<font color=red>();<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтрокаСклад<font color=red>.</font>Док <font color=red>= </font>СкладскиеДокументы<font color=red>.</font>Ссылка<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтрокаСклад<font color=red>.</font>Картинко <font color=red>= ?(</font>СтрокаСклад<font color=red>.</font>Док<font color=red>.</font>Проведен<font color=red>, </font><font color=black>1</font><font color=red>, ?(</font>СтрокаСклад<font color=red>.</font>Док<font color=red>.</font>ПометкаУдаления<font color=red>, </font><font color=black>2</font><font color=red>, </font><font color=black>0</font><font color=red>));<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ВсегоПройдетПоДокументу <font color=red>= </font><font color=black>0</font><font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; Для Каждого </font>СтрокаДокумента <font color=red>Из </font>СтрокаСклад<font color=red>.</font>Док<font color=red>.</font>Товары <font color=red>Цикл<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>СтрокаСТоваром <font color=red>= </font>СтрокаСклад<font color=red>.</font>Строки<font color=red>.</font>Добавить<font color=red>();<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>СтрокаСТоваром<font color=red>.</font>Док <font color=red>= </font>СтрокаДокумента<font color=red>.</font>Номенклатура<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>СтрокаСТоваром<font color=red>.</font>Количество <font color=red>= </font>СтрокаДокумента<font color=red>.</font>Количество<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>ВсегоПройдетПоДокументу <font color=red>= </font>ВсегоПройдетПоДокументу <font color=red>+ </font>СтрокаДокумента<font color=red>.</font>Количество<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; КонецЦикла;<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтрокаСклад<font color=red>.</font>Количество <font color=red>= </font>ВсегоПройдетПоДокументу<font color=red>;<br>
&nbsp; &nbsp; КонецЦикла;<br>
КонецЦикла;<br>
</font></p></pre> Готово! Теперь у нас есть вот такого вида форма
<img src="http://i.imgur.com/LoUtLYg.png" alt="Дерево на форме"></p>
<h3 id="-">Вывод картинки отображающей статус для каждого документа.</h3>
<p>Следует заметить, что для наглядности в дереве отмечается статус документов(проведен, не проведен, помечен на удаление), как вы поняли в выше приведенном коде за этот момент отвечает вот эта строка:</p>
<p><pre><p>СтрокаСклад<font color=red>.</font>Картинко <font color=red>= ?(</font>СтрокаСклад<font color=red>.</font>Док<font color=red>.</font>Проведен<font color=red>, </font><font color=black>1</font><font color=red>, ?(</font>СтрокаСклад<font color=red>.</font>Док<font color=red>.</font>ПометкаУдаления<font color=red>, </font><font color=black>2</font><font color=red>, </font><font color=black>0</font><font color=red>));<br>
</font></p></pre>
Для начала определимся с самой картинкой, вот она: <img src="http://i.imgur.com/PD7usod.png" alt="Статус проведенности документа">
Для того, что бы увидеть эту картинку в одной из колонок нужно:</p>
<ol>
<li>Добавить эту картинку в свойство <code>КартинкиСтрок</code> у колонки для которой мы хотим отображать эту картинку.</li>
<li>Указать у нужной колонки свойство <code>ДанныеКартинки</code>. Указав данное свойство, мы фактически добавили еще одну колонку в которой будет храниться индекс отображаемой картинки</li>
<li>Заполнить свойство <code>ДанныеКартинки</code> при добавлении строки.</li>
</ol>
<h3 id="-">Формирование отчета СКД из существующего макета.</h3>
<p>Так как у нас просто есть схема которая лежит в макете, внешней обработки, то нам надо програмно:</p>
<ul>
<li>Загрузить схему в компоновщик макета.</li>
<li>Инициализировать настройки на основании, нашей схемы.</li>
<li>Установить параметры отчета.</li>
</ul>
<p>Вроде бы все достаточно просто, но на понимание того как это должно происходить, может уйти достаточно много времени. После детального изучения вопроса, была найдена <a href="http://infostart.ru/public/80164/">статья</a> откуда была выдернута вот эта процедура</p>
<p><pre><p><font color=red>Процедура </font>ПолучитьДанныеНаОснованииСКД<font color=red>(</font>СКД<font color=red>, </font>ОбъектДляЗагрузки<font color=red>, </font>ИсполняемыеНастройки <font color=red>= Неопределено, </font>СтруктураПараметров <font color=red>= Неопределено, </font>РасшифровкаСКД <font color=red>= Неопределено, </font>МакетКомпоновки <font color=red>= Неопределено, </font>ВнешниеНаборыДанных <font color=red>= Неопределено) Экспорт<br>
<br>
&nbsp; &nbsp; </font>КомпоновщикМакета <font color=red>= Новый </font>КомпоновщикМакетаКомпоновкиДанных<font color=red>;<br>
<br>
&nbsp; &nbsp; Если </font>ТипЗнч<font color=red>(</font>ОбъектДляЗагрузки<font color=red>) = </font>Тип<font color=red>(</font><font color=black>&quot;ПолеТабличногоДокумента&quot;</font><font color=red>) ИЛИ </font>ТипЗнч<font color=red>(</font>ОбъектДляЗагрузки<font color=red>) = </font>Тип<font color=red>(</font><font color=black>&quot;ТабличныйДокумент&quot;</font><font color=red>) Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ТипГенератора <font color=red>= </font>Тип<font color=red>(</font><font color=black>&quot;ГенераторМакетаКомпоновкиДанных&quot;</font><font color=red>);<br>
&nbsp; &nbsp; Иначе<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ТипГенератора <font color=red>= </font>Тип<font color=red>(</font><font color=black>&quot;ГенераторМакетаКомпоновкиДанныхДляКоллекцииЗначений&quot;</font><font color=red>);<br>
&nbsp; &nbsp; КонецЕсли;<br>
&nbsp; &nbsp; Если </font>ИсполняемыеНастройки <font color=red>= Неопределено Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ИсполняемыеНастройки <font color=red>= </font>СКД<font color=red>.</font>НастройкиПоУмолчанию<font color=red>;<br>
&nbsp; &nbsp; КонецЕсли;<br>
<br>
&nbsp; &nbsp; Если </font>СтруктураПараметров <font color=red>&lt;&gt; Неопределено Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>КоллекцияЗначенийПараметров <font color=red>= </font>ИсполняемыеНастройки<font color=red>.</font>ПараметрыДанных<font color=red>.</font>Элементы<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; Для каждого </font>Параметр <font color=red>Из </font>СтруктураПараметров <font color=red>Цикл<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>НайденноеЗначениеПараметра <font color=red>= </font>КоллекцияЗначенийПараметров<font color=red>.</font>Найти<font color=red>(</font>Параметр<font color=red>.</font>Ключ<font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Если </font>НайденноеЗначениеПараметра <font color=red>&lt;&gt; Неопределено Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>НайденноеЗначениеПараметра<font color=red>.</font>Использование <font color=red>= Истина;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>НайденноеЗначениеПараметра<font color=red>.</font>Значение <font color=red>= </font>Параметр<font color=red>.</font>Значение<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; КонецЕсли;<br>
&nbsp; &nbsp; &nbsp; &nbsp; КонецЦикла;<br>
&nbsp; &nbsp; КонецЕсли;<br>
<br>
&nbsp; &nbsp; </font>МакетКомпоновкиСКД <font color=red>= </font>КомпоновщикМакета<font color=red>.</font>Выполнить<font color=red>(</font>СКД<font color=red>, </font>ИсполняемыеНастройки<font color=red>, </font>РасшифровкаСКД<font color=red>, </font>МакетКомпоновки<font color=red>, </font>ТипГенератора<font color=red>);<br>
&nbsp; &nbsp; </font>ПроцессорКомпоновки <font color=red>= Новый </font>ПроцессорКомпоновкиДанных<font color=red>;<br>
&nbsp; &nbsp; </font>ПроцессорКомпоновки<font color=red>.</font>Инициализировать<font color=red>(</font>МакетКомпоновкиСКД<font color=red>, </font>ВнешниеНаборыДанных<font color=red>, </font>РасшифровкаСКД<font color=red>);<br>
<br>
&nbsp; &nbsp; Если </font>ТипЗнч<font color=red>(</font>ОбъектДляЗагрузки<font color=red>) = </font>Тип<font color=red>(</font><font color=black>&quot;ПолеТабличногоДокумента&quot;</font><font color=red>) ИЛИ </font>ТипЗнч<font color=red>(</font>ОбъектДляЗагрузки<font color=red>) = </font>Тип<font color=red>(</font><font color=black>&quot;ТабличныйДокумент&quot;</font><font color=red>) Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ПроцессорВывода <font color=red>= Новый </font>ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ПроцессорВывода<font color=red>.</font>УстановитьДокумент<font color=red>(</font>ОбъектДляЗагрузки<font color=red>);<br>
&nbsp; &nbsp; Иначе<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ПроцессорВывода <font color=red>= Новый </font>ПроцессорВыводаРезультатаКомпоновкиДанныхВКоллекциюЗначений<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ПроцессорВывода<font color=red>.</font>УстановитьОбъект<font color=red>(</font>ОбъектДляЗагрузки<font color=red>);<br>
&nbsp; &nbsp; КонецЕсли;<br>
<br>
&nbsp; &nbsp; </font>ПроцессорВывода<font color=red>.</font>ОтображатьПроцентВывода <font color=red>= Истина;<br>
&nbsp; &nbsp; </font>ПроцессорВывода<font color=red>.</font>Вывести<font color=red>(</font>ПроцессорКомпоновки<font color=red>, Истина);<br>
КонецПроцедуры</font></p></pre>
ее суть проста: на входе макет, на выходе табличный документ. Теперь когда мы умеем формировать табличный документ на основе макета, мы можем одним легким движением, добавить расшифровку движений по складу для номенклатуры которая есть в нашем отчете. Приступаем.</p>
<h3 id="-">Формирование истории движений конкретной номенклатуру по событию ни форме.</h3>
<p>огда возникают вопросы: &quot;А в чем дело, почему у меня тосола -15 банок, я ведь все правильно делал&quot;, самое время пожать плечами и молча ткнуть пользователя в историю движений. Тут нам и поможет наш отчет на СКД. Мысль следующая: когда мы щелкаем на поле два раза по какой то номенклатуре, инициализируется простейший отчет на СКД который выводит все движения по таблице остатки и обороты регистра <code>ТоварыВРознице</code>. Отчет достаточно простой постороенный вот на таком запросе.</p>
<p><pre><p style="text-align: left; font-family: courier new,courier; color: black"><font color=blue>ВЫБРАТЬ<br>
&nbsp; &nbsp; </font>ТоварыВРозницеОстаткиИОбороты.Период<font color=blue>,<br>
&nbsp; &nbsp; </font>ТоварыВРозницеОстаткиИОбороты.Регистратор<font color=blue>,<br>
&nbsp; &nbsp; </font>ТоварыВРозницеОстаткиИОбороты.КоличествоНачальныйОстаток<font color=blue>,<br>
&nbsp; &nbsp; </font>ТоварыВРозницеОстаткиИОбороты.КоличествоПриход<font color=blue>,<br>
&nbsp; &nbsp; </font>ТоварыВРозницеОстаткиИОбороты.КоличествоРасход<font color=blue>,<br>
&nbsp; &nbsp; </font>ТоварыВРозницеОстаткиИОбороты.КоличествоКонечныйОстаток<br></p>
<p><font color=blue>ИЗ<br>
&nbsp; &nbsp; </font>РегистрНакопления.ТоварыВРознице.ОстаткиИОбороты<font color=blue>(<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>Регистратор<font color=blue>,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>Номенклатура <font color=blue>= </font><font color=#008b8b>&amp;Номенклатура<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font><font color=brown>И </font>Склад <font color=blue>= </font><font color=#008b8b>&amp;Склад</font><font color=blue>) КАК </font>ТоварыВРозницеОстаткиИОбороты</p></pre> я думаю вы натыкаете его мышкой за 2 минуты.
<em>Перед тем как продолжить, я хотел бы попросить читателя если он еще не разобрался, понять что табличное поле и табличный документ это абсолютно разные сущности. Табличное поле, может быть списком значений, таблицей значений или деревом значений. Табличный документ это объект для формирования печатных форм, он имеет структуру схожую с excel но похожесть чисто внешняя.</em></p>
<h4 id="-">Подготовительные действия.</h4>
<p>Добавляем макет в обработку, указываем тип макета &quot;Схема компоновки данных&quot;. Теперь можно им пользоваться в самой обработке. Можно сразу вывести отчет в табличный документ и на этом расслабиться, но тогда в нем не будет работать расшифровка, что бы в отчете работала расшифровка, табличный документ должен находиться на какой нибудь форме. Поэтому нам нужна форма и мы ее добавим как произвольную форму для обработки и поместим на нее табличный документ куда и будем выводить наш отчет. На этом все подготовительные действия закончены.</p>
<h4 id="-">Вывод отчета из подготовленного макета в подготоваленную форму.</h4>
<p>Далее нам нужен план действий, приблизительно следующего вида, когда пользователь щелкает по строке табличного поля на форме, то:</p>
<ol>
<li>Если он щелкает по строке указывающей на документ, от открывается форма документа.</li>
<li>Если он щелкает по номенклатуре, то нам нужно<ol>
<li>Загрузить макет формирующий историю движений.</li>
<li>Получить форму отчета, с табличным документом куда мы будем грузить отчет и реквизитом <code>ОбработчикРасшифровки</code> произвольного типа куда мы будем передавать расшифровку.</li>
<li>Вывести на основании макета отчет в полученную форму и настроить обработку расшифровки.</li>
</ol>
</li>
</ol>
<p>Вешаем на событие &#39;Выбор&#39; табличного поля, следующую процедуру:</p>
<p><pre><p><font color=red>Процедура </font>СписокДокументовВыбор<font color=red>(</font>Элемент<font color=red>, </font>ВыбраннаяСтрока<font color=red>, </font>Колонка<font color=red>, </font>СтандартнаяОбработка<font color=red>)<br>
&nbsp; &nbsp; </font>СтандартнаяОбработка <font color=red>= Ложь;<br>
&nbsp; &nbsp; Если </font>Документы<font color=red>.</font>ТипВсеСсылки<font color=red>().</font>СодержитТип<font color=red>(</font>ТипЗнч<font color=red>(</font>ВыбраннаяСтрока<font color=red>.</font>Док<font color=red>)) Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ВыбраннаяСтрока<font color=red>.</font>Док<font color=red>.</font>ПолучитьФорму<font color=red>().</font>Открыть<font color=red>();<br>
&nbsp; &nbsp; Иначе<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СхемаКомпоновкиДанных <font color=red>= </font>ПолучитьМакет<font color=red>(</font><font color=black>&quot;ОтчетПоДвижениямНоменклатуры&quot;</font><font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураПараметров <font color=red>= Новый </font>Структура<font color=red>();<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураПараметров<font color=red>.</font>Вставить<font color=red>(</font><font color=black>&quot;НачалоПериода&quot;</font><font color=red>, </font>ТекущаяДата<font color=red>() - </font><font color=black>31556926</font><font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураПараметров<font color=red>.</font>Вставить<font color=red>(</font><font color=black>&quot;КонецПериода&quot;</font><font color=red>, </font>ТекущаяДата<font color=red>());<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураПараметров<font color=red>.</font>Вставить<font color=red>(</font><font color=black>&quot;Номенклатура&quot;</font><font color=red>, </font>ЭлементыФормы<font color=red>.</font>СписокДокументов<font color=red>.</font>ТекущаяСтрока<font color=red>.</font>Док<font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураПараметров<font color=red>.</font>Вставить<font color=red>(</font><font color=black>&quot;Склад&quot;</font><font color=red>, </font>ЭлементыФормы<font color=red>.</font>СписокДокументов<font color=red>.</font>ТекущаяСтрока<font color=red>.</font>Родитель<font color=red>.</font>Док<font color=red>.</font>Склад<font color=red>);<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Расшифровка <font color=red>= Новый </font>ДанныеРасшифровкиКомпоновкиДанных<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ФормаОтчета <font color=red>= </font>ПолучитьФорму<font color=red>(</font><font color=black>&quot;ИсторияДвижений&quot;</font><font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ПолучитьДанныеНаОснованииСКД<font color=red>(</font>СхемаКомпоновкиДанных<font color=red>, </font>ФормаОтчета<font color=red>.</font>ЭлементыФормы<font color=red>.</font>ПолеТабличногоДокумента1<font color=red>, </font>СхемаКомпоновкиДанных<font color=red>.</font>НастройкиПоУмолчанию<font color=red>, </font>СтруктураПараметров<font color=red>, </font>Расшифровка<font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ФормаОтчета<font color=red>.</font>ОбработчикРасшифровки <font color=red>= Новый </font>ОбработкаРасшифровкиКомпоновкиДанных<font color=red>(</font>Расшифровка<font color=red>, Новый </font>ИсточникДоступныхНастроекКомпоновкиДанных<font color=red>(</font>СхемаКомпоновкиДанных<font color=red>));<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ФормаОтчета<font color=red>.</font>Открыть<font color=red>();<br>
&nbsp; &nbsp; КонецЕсли;<br>
КонецПроцедуры<br></font></p></pre>
которая реализует почти все кроме пункта 2.3. Остался последний штрих, добавить в открываюмую форму обработку расшифровки. Для этого используем событие <code>ОбработкаРасшифровки</code> где укажем следующий код:</p>
<p><pre><p>
ОбработчикРасшифровки<font color=red>.</font>Выполнить<font color=red>(</font>Расшифровка<font color=red>);<br>
</font>СтандартнаяОбработка <font color=red>= Ложь;<br>
</font></p></pre>
Теперь расшифровка должна работать как и собственно сама обработка.</p>
<h3 id="-">Заключение</h3>
<p>как обычно почти весь код приведен и снабжен комментариями, но если у вас не получается собрать аленький цветочек <a href="http://infostart.ru/public/171476/">можно скачать обработку на инфостарте</a></p>
]]></description>
            <link>http://localhost:9778/posts/007_inventory_and_skd</link>
            <guid isPermaLink="true">http://localhost:9778/posts/007_inventory_and_skd</guid>
            <pubDate>Tue, 28 Oct 2014 13:07:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Двойные штрихкода и история одной обработки]]></title>
            <description><![CDATA[<h3 id="-">Преамбула</h3>
<p>В какой то момент в базе встала проблема двойных штрихкодов. Причем ситация до того как на нее обратили внимание, приобрела катосторофический характер и имела полторы тысячи дублей штрихкодов (когда один штрихкод принадлежит нескольким товарам) и порядка 25ти тысяч дублей товаров (когда у одного товарам есть несколько штрихкодов). Что тому виной? На текущий момент уже сложно сказать. Возможно РИБ, когда одному и тому же товару присваивают штрихкод в разных базах. Возможно свою лепту внесли слияния нескольких баз с одинаковым товаром, но разными штрихкодами. Скорее всего все вместе + какой то еще фактор, который мы пока не можем найти. Слишком много вышло дублей, почти четверть базы. Так или иначе встала задача с этими штрихкодами что то сделать.</p>
<h3 id="-">Постановка задачи.</h3>
<p>Необходимо найти задублирововашиеся штрихкода и показить пользователю в удобном виде. Дать возможность что то сделать сразу с этими штрихкодами без необходимости лазить по справочникам и регистрам. Если говорить конкретно, то у пользователя должна быть возможность:</p>
<ol>
<li>Удалить все штрихкода у владельца, кроме выделенного.</li>
<li>Удалить конкретный лишний штрихкод.</li>
<li>Одним махом удалить все лишние дубли, оставив по одному на владельца.</li>
<li>Удалить все штрихкода которые засветились как задублированные.</li>
</ol>
<h3 id="-">Приступим к реализации первой части.</h3>
<p>Поиск лишних штрихкодов. Сам поиск достататочно банален: нужно воспользоваться функций КОЛИЧЕСТВО(РАЗЛИЧНЫЕ СюдаУказатьПолеДляГруппировки). В самом простом случае, запрос будет выглядеть вот так:</p>
<p><p style="text-align: left; font-family: courier new,courier; color: black"></p>
<p><font color=blue>ВЫБРАТЬ<br>
&nbsp; &nbsp; </font>Штрихкоды.Штрихкод<font color=blue>,<br>
&nbsp; &nbsp; </font><font color=brown>КОЛИЧЕСТВО</font><font color=blue>(РАЗЛИЧНЫЕ </font>Штрихкоды.Владелец<font color=blue>) КАК </font>Владелец<br></p>
<p><font color=blue>ИЗ<br>
&nbsp; &nbsp; </font>РегистрСведений.Штрихкоды <font color=blue>КАК </font>Штрихкоды<br>
<br></p>
<p><font color=blue>СГРУППИРОВАТЬ ПО<br>
&nbsp; &nbsp; </font>Штрихкоды.Штрихкод</p>
Для того, что бы отфильтровать результаты запроса необходимо его обернуть во вложеный запрос и тогда уже можно накладывать условия на результат его работы. В целом нормально, но как то неудобно, для удобства наверно не помешает сгруппировать результаты по штрихкодам. В результате мы можем получить вот такой запрос. Вот результат его работы в консоли.
<img src="https://api.monosnap.com/image/download?id=5e8qdGdh0ss6sMzCTYOarse6J" alt="Результат работы запроса" title="Результат работы запроса в консоли">
Этот вариант удобен для первого варианта поиска, сделать запрос для второго варианта по аналогии не должно составить труда. Запросы готовы, но не будет же пользователь смотреть на результат его работы из консоли. Здесь нам и поможет дерево значений. Смысл работы с деревом следующий: дерево содержит колекцию колонок и строк. Коллекция колонок не отличается от коллекции колонок в таблице значений и нас не интересует. Коллекция строк немного инетереснее, каждая строка ее может содержать такую же коллекцию строк, каждая строка которой... вообщем я думаю мысль понятна, таким образом и организуется иерархия. Используем обход результатов запроса по группировкам, для того что сформировать удобное дерево:</p>
<pre><p>&nbsp; &nbsp; Выборка <font color=red>= </font>Запрос<font color=red>.</font>Выполнить<font color=red>().</font>Выбрать<font color=red>(</font>ОбходРезультатаЗапроса<font color=red>.</font>ПоГруппировкам<font color=red>);<br>
&nbsp; &nbsp; </font>ЭтаФорма<font color=red>.</font>Заголовок <font color=red>= </font><font color=black>"Найдено " </font><font color=red>+ </font>Выборка<font color=red>.</font>Количество<font color=red>();<br>
&nbsp; &nbsp; Пока </font>Выборка<font color=red>.</font>Следующий<font color=red>() Цикл<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>НоваяСтрокаТП <font color=red>= </font>ТабличноеПоле<font color=red>.</font>Строки<font color=red>.</font>Добавить<font color=red>();<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>НоваяСтрокаТП<font color=red>.</font>Номенклатура <font color=red>= </font>Выборка<font color=red>.</font>Штрихкод<font color=red>;<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ВыборкаШтрихКода <font color=red>= </font>Выборка<font color=red>.</font>Выбрать<font color=red>();<br>
&nbsp; &nbsp; &nbsp; &nbsp; Пока </font>ВыборкаШтрихКода<font color=red>.</font>Следующий<font color=red>() Цикл<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>НоваяСтрокаВладелец <font color=red>= </font>НоваяСтрокаТП<font color=red>.</font>Строки<font color=red>.</font>Добавить<font color=red>();<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>НоваяСтрокаВладелец<font color=red>.</font>Номенклатура <font color=red>= </font>ВыборкаШтрихКода<font color=red>.</font>Владелец<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; КонецЦикла;<br>
&nbsp; &nbsp; КонецЦикла;</font></p></pre>

<p>Как следствие мы можем получить вот такую форму:
<img src="https://api.monosnap.com/image/download?id=wDPn9V8vDlujcauOfMSIonqUr" alt="Форма обработки" title="Сгруппированные штрихкода на форме"></p>
<h3 id="-">Работа с регистром штрихкодов</h3>
<p>Когда есть все нужные данные можно начинать работать с регистром штрихкодов. Так как у нас ищутся не только штрихкода с несколькими владельцами, но и владельцы с несколькими штрихкодами, то состав табличного поля может быть разным, это необходимо учитывать. Приступим к реализации п1 - Удалить все штрихкода кроме выделенного. Для этого подготовим данные для записи в регистр. Выделим значение отобора и штрихкод который нам надо оставить:</p>
<pre><p>&nbsp; &nbsp; СтруктураВРегистр <font color=red>= Новый </font>Структура<font color=red>(</font><font color=black>"КлючОтбора, ЗначениеОтбора, ШтрихКод, Владелец"</font><font color=red>);<br>
<br>
&nbsp; &nbsp; Если </font>ТипЗнч<font color=red>(</font>СтрокаДерева<font color=red>.</font>Номенклатура<font color=red>) = </font>Тип<font color=red>(</font><font color=black>"СправочникСсылка.Номенклатура"</font><font color=red>)<br>
&nbsp; &nbsp; &nbsp; &nbsp; ИЛИ </font>ТипЗнч<font color=red>(</font>СтрокаДерева<font color=red>.</font>Номенклатура<font color=red>) = </font>Тип<font color=red>(</font><font color=black>"СправочникСсылка.ИнформационныеКарты"</font><font color=red>) Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураВРегистр<font color=red>.</font>КлючОтбора <font color=red>= </font><font color=black>"Штрихкод"</font><font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураВРегистр<font color=red>.</font>ЗначениеОтбора <font color=red>= </font>СтрокаДерева<font color=red>.</font>Родитель<font color=red>.</font>Номенклатура<font color=red>;<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураВРегистр<font color=red>.</font>Штрихкод <font color=red>= </font>СтрокаДерева<font color=red>.</font>Родитель<font color=red>.</font>Номенклатура<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураВРегистр<font color=red>.</font>Владелец <font color=red>= </font>СтрокаДерева<font color=red>.</font>Номенклатура<font color=red>;<br>
&nbsp; &nbsp; Иначе<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураВРегистр<font color=red>.</font>КлючОтбора <font color=red>= </font><font color=black>"Владелец"</font><font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураВРегистр<font color=red>.</font>ЗначениеОтбора <font color=red>= </font>СтрокаДерева<font color=red>.</font>Родитель<font color=red>.</font>Номенклатура<font color=red>;<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураВРегистр<font color=red>.</font>Штрихкод <font color=red>= </font>СтрокаДерева<font color=red>.</font>Номенклатура<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураВРегистр<font color=red>.</font>Владелец <font color=red>= </font>СтрокаДерева<font color=red>.</font>Родитель<font color=red>.</font>Номенклатура<font color=red>;<br>
&nbsp; &nbsp; КонецЕсли;<br></font></p></pre>

<p>Теперь надо удалить все &quot;лишние&quot; штрихкода кроме конкретного, того на который указал пользователь. Я решил этот вопрос просто: я очищаю набор по указанному отбору и добавляю нужный штрихкод. По моему это самый простой и быстрый способ. Вот код:</p>
<pre><p>
НаборЗаписей <font color=red>= </font>РегистрыСведений<font color=red>.</font>Штрихкоды<font color=red>.</font>СоздатьНаборЗаписей<font color=red>();<br>
</font>НаборЗаписей<font color=red>.</font>Отбор<font color=red>[</font>СтруктураСДанными<font color=red>.</font>КлючОтбора<font color=red>].</font>Установить<font color=red>(</font>СтруктураСДанными<font color=red>.</font>ЗначениеОтбора<font color=red>);<br>
</font>НаборЗаписей<font color=red>.</font>Записать<font color=red>();<br>
<br>
</font>НоваяЗаписьНабора <font color=red>= </font>НаборЗаписей<font color=red>.</font>Добавить<font color=red>();<br>
</font>НоваяЗаписьНабора<font color=red>.</font>Владелец <font color=red>= </font>СтруктураСДанными<font color=red>.</font>Владелец<font color=red>;<br>
</font>НоваяЗаписьНабора<font color=red>.</font>ЕдиницаИзмерения <font color=red>= </font>СтруктураСДанными<font color=red>.</font>Владелец<font color=red>.</font>ЕдиницаХраненияОстатков<font color=red>;<br>
</font>НоваяЗаписьНабора<font color=red>.</font>ТипШтрихкода <font color=red>= </font>ПланыВидовХарактеристик<font color=red>.</font>ТипыШтрихкодов<font color=red>.</font>EAN13<font color=red>;<br>
</font>НоваяЗаписьНабора<font color=red>.</font>Штрихкод <font color=red>= </font>СтруктураСДанными<font color=red>.</font>ШтрихКод<font color=red>;<br>
</font>НоваяЗаписьНабора<font color=red>.</font>Качество <font color=red>= </font>Справочники<font color=red>.</font>Качество<font color=red>.</font>Новый<font color=red>;<br>
<br>
</font>НаборЗаписей<font color=red>.</font>Записать<font color=red>();</font></p></pre>

<p>Перебирая строки дерева значений можно реализовать и п.3. Мы же идем дальше и приступаем к п.2. Для этих целей я использовал менеджер записи, в целом тут все просто до безобразия:</p>
<p><pre><p>&nbsp; &nbsp; <font color=red>Если </font>ТипЗнч<font color=red>(</font>ЭлементыФормы<font color=red>.</font>ТабличноеПоле<font color=red>.</font>ТекущиеДанные<font color=red>.</font>Номенклатура<font color=red>) = </font>Тип<font color=red>(</font><font color=black>&quot;СправочникСсылка.Номенклатура&quot;</font><font color=red>)<br>
&nbsp; &nbsp; &nbsp; &nbsp; ИЛИ </font>ТипЗнч<font color=red>(</font>ЭлементыФормы<font color=red>.</font>ТабличноеПоле<font color=red>.</font>ТекущиеДанные<font color=red>.</font>Номенклатура<font color=red>) = </font>Тип<font color=red>(</font><font color=black>&quot;СправочникСсылка.ИнформационныеКарты&quot;</font><font color=red>) Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Штрихкод <font color=red>= </font>ЭлементыФормы<font color=red>.</font>ТабличноеПоле<font color=red>.</font>ТекущаяСтрока<font color=red>.</font>Родитель<font color=red>.</font>Номенклатура<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Владелец <font color=red>= </font>ЭлементыФормы<font color=red>.</font>ТабличноеПоле<font color=red>.</font>ТекущиеДанные<font color=red>.</font>Номенклатура<font color=red>;<br>
&nbsp; &nbsp; Иначе<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Штрихкод <font color=red>= </font>ЭлементыФормы<font color=red>.</font>ТабличноеПоле<font color=red>.</font>ТекущиеДанные<font color=red>.</font>Номенклатура<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Владелец <font color=red>= </font>ЭлементыФормы<font color=red>.</font>ТабличноеПоле<font color=red>.</font>ТекущаяСтрока<font color=red>.</font>Родитель<font color=red>.</font>Номенклатура<font color=red>;<br>
&nbsp; &nbsp; КонецЕсли;<br>
<br>
</font>МенеджерЗаписи <font color=red>= </font>РегистрыСведений<font color=red>.</font>Штрихкоды<font color=red>.</font>СоздатьМенеджерЗаписи<font color=red>();<br>
</font>МенеджерЗаписи<font color=red>.</font>Штрихкод <font color=red>= </font>Штрихкод<font color=red>;<br>
</font>МенеджерЗаписи<font color=red>.</font>Владелец <font color=red>= </font>Владелец<font color=red>;<br>
</font>МенеджерЗаписи<font color=red>.</font>ТипШтрихкода <font color=red>= </font>ПланыВидовХарактеристик<font color=red>.</font>ТипыШтрихкодов<font color=red>.</font>EAN13<font color=red>;<br>
</font>МенеджерЗаписи<font color=red>.</font>ЕдиницаИзмерения <font color=red>= </font>Владелец<font color=red>.</font>ЕдиницаХраненияОстатков<font color=red>;<br>
</font>МенеджерЗаписи<font color=red>.</font>Качество <font color=red>= </font>Справочники<font color=red>.</font>Качество<font color=red>.</font>Новый<font color=red>;<br>
</font>МенеджерЗаписи<font color=red>.</font>Прочитать<font color=red>();<br>
</font>МенеджерЗаписи<font color=red>.</font>Удалить<font color=red>();</font></p></pre>
Остался последний самый простой пункт. Я думаю тут даже код не нужен. Все и так просто. Делаем отбор в наборе и записываем не читая. Вот такая получилась обработка. Почти весь нужный код для работы обработки в этой статье есть. За бортом осталась косметика, украшательства и тд, то, что каждый настраивает по своему вкусу, но если все таки у вас не вышло собрать обработку, то обработку можно <a href="http://infostart.ru/public/200131/">скачать на инфостарте</a>.</p>
]]></description>
            <link>http://localhost:9778/posts/006_double_barcode</link>
            <guid isPermaLink="true">http://localhost:9778/posts/006_double_barcode</guid>
            <pubDate>Sun, 08 Sep 2013 12:03:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Печать этикеток из поступления только отмеченной номенклатуры]]></title>
            <description><![CDATA[<h3 id="-">В чем соль?</h3>
<p>Реквизит в табличную часть документа добавлять нельзя, так как установка флажка изменяет табличную часть, то форма получает признак модифицированности и постоянные вопросы о необходимости сохранять документ, немного нервируют пользователя(а если документ большой и проведенный, то процедура сохранения, еще и какое то время занимает) в целом это можно было бы и пережить(можно и признак модифицированности скидывать), но клиент мириться с этим не захотел, а так как если при печати все равно придется анализировать табличное поле, было решено сделать колонку не связанную с данными табличной части. В результате анализа ситуации стало ясно следующее:</p>
<ol>
<li><p>Если данные не хранятся в табличной части, то придется самому позаботится о том где мы будеи держать информацию об отмеченных строках.</p>
</li>
<li><p>Механизм отрисовки флажка тоже придется взять на себя.</p>
</li>
</ol>
<p>Как обычно прежде чем начинать городить велосипед, был сделан запрос к <a href="http://www.forum.mista.ru" title="миста">базе знаний</a> и выяснено следующее: для моего случая уже есть описанный случай на ИТС и называется он <code>Реализация отметки строк флажками в табличном поле</code>. Раз есть готовый код, то берем его, модифицируем, используем. Итак поехали:</p>
<h3 id="-">Реализация отметок в табличном поле</h3>
<p>Для начала, надо добавить колонку в табличное поле и нужно указать, что элемент управления - флажок, ну и название придумать какое нибудь. Теперь надо позаботится об объекте где будут храниться данные об наших отметках. Это будет переменная и называться она будет <code>СписокОтметок</code>, так и объявим в начале модуля:
<code>Перем СписокОтметок;</code>
в конце где выполняется код при открытии модуля (если не понимаете о чем я просто поставьте самой последней строкой) укажем тип нашей переменной: <code>СписокОтметок = Новый Соответствие.</code></p>
<p>Теперь надо организовать изменение этого списка, когда пользователь щелкает по флажку в табличной части, для этого подойдет событие табличного поля <code>ПриИзмененииФлажка</code>, в нем нам надо указать следующее:</p>
<pre><p><font color=red>Процедура </font>ТоварыПриИзмененииФлажка<font color=red>(</font>Элемент<font color=red>, </font>Колонка<font color=red>)<br>
&nbsp; &nbsp; Если </font>Колонка<font color=red>.</font>Имя <font color=red>= </font><font color=black>"Отметка" </font><font color=red>Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; Если </font>СписокОтметок<font color=red>[</font>Элемент<font color=red>.</font>ТекущаяСтрока<font color=red>] = Неопределено Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>СписокОтметок<font color=red>[</font>Элемент<font color=red>.</font>ТекущаяСтрока<font color=red>] = Истина;<br>
&nbsp; &nbsp; &nbsp; &nbsp; Иначе<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>СписокОтметок<font color=red>.</font>Удалить<font color=red>(</font>Элемент<font color=red>.</font>ТекущаяСтрока<font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; КонецЕсли;<br>
&nbsp; &nbsp; КонецЕсли;<br>
КонецПроцедуры</font></p></pre>

<p>Что здесь происходит: когда пользователь щелкает по флажку, процедура ищет нужную строку табличной части и если ее нет, то добавляет, если есть удалет, таким образом, осуществляя изменение состояния флажка.</p>
<p>Теперь нужно организовать вывод флажков в табличное поле, на текущий момент юзер не видит установленных флажков в табличном поле. Для работы с выводом, нужно использовать событие <code>ПриВыводеСтроки</code> вот такой код используется для вывода флажка:</p>
<pre><p>ОформлениеСтроки<font color=red>.</font>Ячейки<font color=red>.</font>Отметка<font color=red>.</font>ОтображатьФлажок <font color=red>= Истина;<br>
Если </font>СписокОтметок<font color=red>[</font>ДанныеСтроки<font color=red>] = Неопределено Тогда<br>
&nbsp; &nbsp; </font>ОформлениеСтроки<font color=red>.</font>Ячейки<font color=red>.</font>Отметка<font color=red>.</font>Флажок <font color=red>= Ложь;<br>
Иначе<br>
&nbsp; &nbsp; </font>ОформлениеСтроки<font color=red>.</font>Ячейки<font color=red>.</font>Отметка<font color=red>.</font>Флажок <font color=red>= Истина;<br>
КонецЕсли;</font></p></pre>

<p>Тут все тоже очень просто: если текущая строка есть в списке отметок мы ее отметим если нету, не будем. Таким образом у нас есть список тех строк табличной части документов, которые были отмечены.</p>
<h3 id="-">Передача отмеченных строк в обработку печати этикеток.</h3>
<p>Для того, что бы передать список номенклатуры, в обработку печати этикеток, я нашел два варианта, это передать ссылку на группу или ссылку на номенклатуру. Или что бы со списком было бы еще количество, можно передать ссылку на документ. Нам не подходит не первое, не второе. Так как нам нужно и количество и определенный список. Поэтому я немного переделал процедуру печати этикеток <code>НапечататьЭтикеткиИзДокумента</code>, которая формирует из ссылки на табличную часть документа, таблицу товары, которую принимает обработка печати этикеток. Для начала я выгрузил в таблицу значений отмеченные значения, загрузил ее во временную таблицу в запросе.</p>
<pre><p>МВТ <font color=red>= Новый </font>МенеджерВременныхТаблиц<font color=red>;<br>
</font>ТаблицаИзДока <font color=red>= Новый </font>Запрос<font color=red>;<br>
</font>ТаблицаИзДока<font color=red>.</font>МенеджерВременныхТаблиц <font color=red>= </font>МВТ<font color=red>;<br>
</font>ТаблицаИзДока<font color=red>.</font>Текст <font color=red>=<br>
&nbsp; &nbsp; </font><font color=black>"Выбрать<br>
&nbsp; &nbsp; |Таблица.Номенклатура,<br>
&nbsp; &nbsp; |Таблица.Количество,<br>
&nbsp; &nbsp; |Таблица.ЕдиницаИзмерения,<br>
&nbsp; &nbsp; |ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка) КАК Характеристика,<br>
&nbsp; &nbsp; |ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка) КАК Серия,<br>
&nbsp; &nbsp; |ЗНАЧЕНИЕ(Справочник.Качество.Новый) КАК Качество,<br>
&nbsp; &nbsp; |0 КАК Цена<br>
&nbsp; &nbsp; |ПОМЕСТИТЬ ТаблицаИЗДока<br>
&nbsp; &nbsp; |ИЗ<br>
&nbsp; &nbsp; |&ТаблицаСДанными КАК Таблица"</font><font color=red>;<br>
</font>ТаблицаИзДока<font color=red>.</font>УстановитьПараметр<font color=red>(</font><font color=black>"ТаблицаСДанными"</font><font color=red>, </font>ТабличкаИЗДокумента<font color=red>);<br>
</font>ТаблицаИзДока<font color=red>.</font>Выполнить<font color=red>();</font></p></pre>

<p>Полученную временную таблицу я передал в запрос, выбирающий данные из регистра штрихкодов:</p>
<pre><p>Запрос <font color=red>= Новый </font>Запрос<font color=red>;<br>
</font>Запрос<font color=red>.</font>МенеджерВременныхТаблиц <font color=red>= </font>МВТ<font color=red>;<br>
</font>Запрос<font color=red>.</font>Текст <font color=red>=<br>
&nbsp; &nbsp; </font><font color=black>"ВЫБРАТЬ<br>
&nbsp; &nbsp; |&nbsp;&nbsp; Док.Номенклатура КАК Номенклатура,<br>
&nbsp; &nbsp; |&nbsp;&nbsp; Док.Количество КАК Количество,<br>
&nbsp; &nbsp; |&nbsp;&nbsp; Док.Характеристика КАК Характеристика,<br>
&nbsp; &nbsp; |&nbsp;&nbsp; Док.Серия КАК Серия,<br>
&nbsp; &nbsp; |&nbsp;&nbsp; Док.Качество КАК Качество,<br>
&nbsp; &nbsp; |&nbsp;&nbsp; Док.ЕдиницаИзмерения КАК ЕдиницаИзмерения,<br>
&nbsp; &nbsp; |&nbsp;&nbsp; Док.Цена КАК Цена,<br>
&nbsp; &nbsp; |&nbsp;&nbsp; РегШК.ТипШтрихкода КАК ТипШтрихкода,<br>
&nbsp; &nbsp; |&nbsp;&nbsp; РегШК.Штрихкод КАК Штрихкод<br>
&nbsp; &nbsp; |ИЗ<br>
&nbsp; &nbsp; |&nbsp;&nbsp; ТаблицаИЗДока КАК Док<br>
&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp;&nbsp; ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.Штрихкоды КАК РегШК<br>
&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp;&nbsp; ПО (РегШК.Владелец = Док.Номенклатура)<br>
&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; И (РегШК.ЕдиницаИзмерения = Док.ЕдиницаИзмерения)<br>
&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; И (РегШК.ХарактеристикаНоменклатуры = Док.Характеристика)<br>
&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; И (РегШК.СерияНоменклатуры = Док.Серия)<br>
&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; И (РегШК.Качество = Док.Качество)"</font><font color=red>;</font></p></pre>
после этого остается только напечатать этикетки
<pre><p>ЗаполнениеДокументов<font color=red>.</font>ПечатьЭтикеток<font color=red>(</font>Запрос<font color=red>.</font>Выполнить<font color=red>().</font>Выгрузить<font color=red>());</font></p></pre>]]></description>
            <link>http://localhost:9778/posts/005_mark_in_table</link>
            <guid isPermaLink="true">http://localhost:9778/posts/005_mark_in_table</guid>
            <pubDate>Sun, 23 Sep 2012 10:53:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Подключение сканера штрихкодов к 1С]]></title>
            <description><![CDATA[<h2 id="-ms-5145-1-">Подключение сканера метролоджик ms 5145 к 1С Управление торговлей.</h2>
<p>Для того что бы разобраться с подключением сканера, нужно понимать, как все работает и какие бывают режимы, что касается ms5145 то это USB сканер который начинает работать сразу после подключения к компьютеру. Если после подключения открыть блокнот и отсканировать штрихкод, то мы в блокноте увидим код который обозначает этот штрихкод, как будто мы набрали его на клавиатуре. То есть он работает сразу из коробки. Итак нам надо что бы сканер работал в 1С. При использовании сканера работает следующая схема: при сканировании штрихкод перехватывет драйвер и передает в 1С. Это специальный драйвер который сделан для того что бы перехватывать события сканирования, не путайте с драйвером самого сканера. В целом схему взаимодействия сканера и 1С можно изобразить так:
<img src="http://i.imgur.com/e5TVKlL.png" alt="Imgur">
 При настройке сканера в 1С нужно указать com  порт (настройки мы рассмотрим внимательно чуть позже) а у нас сканер работает как клавиатура. Вариантов у нас несколько.</p>
<ol>
<li><p>Использование режима ввода с клавитуры. Перед сканированием в окне подбора, в документе ЧЕКККМ, Реализация товаров и услуг, нажать F7 и отсканировать штрихкод. Штрихкод отсканируется и сам нажмет ОК. Как будто это вы сами набрали штрихкод с клавиатуры.</p>
</li>
<li><p>Использование старого драйвера Атол. Драйвер Атол платный и стоит нормальных денег, бесплатно он сканирует с 10ти секундной задержкой. Можно поискать в инете бесплатную версию DTO6_2009_02_11, при установке этого драйвера в списке ком портов появляется пункт клавиатура  указываем его и все ок, поиск по штрихкоду происходит при сканировании штрихкода без лишних движений.</p>
</li>
<li><p>Перевод сканера в режим эмуляции com порта для перевода. Если перевести сканер в режим эмуляции com порта то он будет делать вид, что подключен через com порт, который ура! можно подсунуть  стандартному драйверу от 1С. Для того, что бы перевести сканер в такой режим, надо отсканировать штрихкод из книжечки которая шла вместе со сканером, если книжечки нет ее можно скачать <a href="http://www.honeywellaidc.com/en-us/pages/Product.aspx?category=Laser&amp;cat=HSM&amp;pid=5145">на офицальном сайте</a> и распечатать нужную страницу из руководства. После того как вы отсканируете код, сканер переключится на режим эмуляции ком порта, система найдет новое устройство и запросит драйвера, их можно взять с офф сайта по вышеприведенной ссылке или скачать <a href="https://googledrive.com/host/0BxFnXEinPWUJckpLWkVCVjc0dUU/drv_metrolologik.zip">мою подборку</a>, откуда она собралась я уже не помню. Но она меня выручала не раз. Указываете путь к драйверу и у вас в системе новый ком порт, все можно его использовать. После этого вам нужно установить драйвер, который будет передавать штрихкод в программу 1С, здесь подойдет любой  драйвер штрихкода от фирмы 1С. Они все умеют перехватывать события от com порта. В случае если у вас сервер терминалов, то у каждого клиента, должен быть свой уникальный com порт, то есть у двух пользователей подключенных к одному серверу терминалов, сканеры должны висеть на разных com портах иначе сканер будет работать только у кого то одного.</p>
</li>
<li><p>С 29.02.12 стадартный драйвер 1С версии 8.0.12.2 (на текущий момент акутальная версия 8.0.14.1 любая версия легко гуглится по версии драйвера например вот так <a href="http://goo.gl/poGiF">Scan_OPOS_8_0_14_1.rar</a> умеет работать с клавиатурными сканерами без танцев-бубнов, переключений в режим эмуляции и тд. После установки драйвера в списке com портов наблюдаем пункт клавиатура, который собственно и отрабатывает событие считывание штрихкода, сканером в режиме клавиатуры. Похоже это самое удобный способ.</p>
</li>
</ol>
<p>Перейдем к настройке сканера, настройка сканера происходит в меню Сервис -&gt; Торговое оборудование -&gt; Подключение и настройка торгового оборудования перейдем на закладку сканеры штрихкода там добавляем строку, открывается справочник торговое оборудование, здесь надо добавить наш сканер, указываем любое название и обработку обслуживания, если вы устанавливали конфигурацию, то ее можно взять в каталоге с шаблонами TradeWareEpf, где то здесь: <code>C:\Users\admin\AppData\Roaming\1C\1Cv82\tmplts\1c\Retail\Номер_Релиза_Конфигурации</code> если не устанавливали, то ищите на диске ИТС, если нет диска ИТС, придется его скачать или загуглить. Потом, указываем порт скорость и другие настройки com порта из диспетчера задач. Собственно все. Буду рад ответить на ваши вопросы в коментариях.</p>
]]></description>
            <link>http://localhost:9778/posts/004_plug_scaner_ut10</link>
            <guid isPermaLink="true">http://localhost:9778/posts/004_plug_scaner_ut10</guid>
            <pubDate>Tue, 18 Sep 2012 13:11:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Программное расположение элементов на форме]]></title>
            <description><![CDATA[<p>Иногда есть необходимость расположить табличное поле на форме программно, например когда нужно добавить неизвестное заранее количество закладок, хорошо если нужно просто добавить закладки, тогда можно просто отделаться :</p>
<p><pre><p>ЭлементыФормы<font color=red>.</font>ПанельСЗакладками<font color=red>.</font>Страницы<font color=red>.</font>Добавить<font color=red>(</font><font color=black>&quot;ЗакладкаСклад&quot;</font><font color=red>+</font>Склад<font color=red>.</font>НомерСклада<font color=red>, </font>Склад<font color=red>.</font>Наименование<font color=red>);</font></p></pre>
но на закладках должно, что то располагаться и это что то, должно иметь размеры, располагаться в конкретно указанном месте у него,  у него должны быть привязки, определены какие то свойства(которых прошу заметить может быть много) и тд, конечно самый логичный способ это нарисовать образец на форме а потом смотря свойства, просто это все перетащить. Должен получиться какой то такой код:</p>
<p><pre><p>ЭлементыФормы<font color=red>.</font>ПанельСЗакладками<font color=red>.</font>Страницы<font color=red>.</font>Добавить<font color=red>(</font><font color=black>&quot;ЗакладкаСклад&quot;</font><font color=red>+</font>Склад<font color=red>.</font>НомерСклада<font color=red>, </font>Склад<font color=red>.</font>Наименование<font color=red>);<br>
</font>ЭлементыФормы<font color=red>.</font>ПанельСЗакладками<font color=red>.</font>ТекущаяСтраница <font color=red>= </font>ЭлементыФормы<font color=red>.</font>ПанельСЗакладками<font color=red>.</font>Страницы<font color=red>[</font><font color=black>&quot;ЗакладкаСклад&quot;</font><font color=red>+</font>Склад<font color=red>.</font>НомерСклада<font color=red>];<br>
</font>ТабличноеПоле <font color=red>= </font>ЭлементыФормы<font color=red>.</font>Добавить<font color=red>(</font>Тип<font color=red>(</font><font color=black>&quot;ТабличноеПоле&quot;</font><font color=red>),</font><font color=black>&quot;ТабличноеПоле&quot;</font><font color=red>+</font>Склад<font color=red>.</font>НомерСклада<font color=red>,Истина,</font>ЭлементыФормы<font color=red>.</font>ПанельСЗакладками<font color=red>);<br>
</font>ТабличноеПоле<font color=red>.</font>Имя <font color=red>= </font><font color=black>&quot;ТабличноеПоле&quot;</font><font color=red>+</font>Склад<font color=red>.</font>НомерСклада<font color=red>;<br>
</font>ТабличноеПоле<font color=red>.</font>Значение <font color=red>= </font>ДвиженияПоСкладам<font color=red>[</font>ТекущийСклад<font color=red>];<br>
</font>ТабличноеПоле<font color=red>.</font>Верх <font color=red>= </font><font color=black>6</font><font color=red>;<br>
</font>ТабличноеПоле<font color=red>.</font>Высота <font color=red>= </font><font color=black>566</font><font color=red>;<br>
</font>ТабличноеПоле<font color=red>.</font>Ширина <font color=red>= </font><font color=black>747</font><font color=red>;<br>
</font>ТабличноеПоле<font color=red>.</font>Лево <font color=red>= </font><font color=black>6</font><font color=red>;<br>
</font>ТабличноеПоле<font color=red>.</font>ВертикальнаяПолосаПрокрутки <font color=red>= </font>ИспользованиеПолосыПрокрутки<font color=red>.</font>Использоватьавтоматически<font color=red>;<br>
</font>ТабличноеПоле<font color=red>.</font>Вывод <font color=red>= </font>ИспользованиеВывода<font color=red>.</font>Авто<font color=red>;<br>
</font>ТабличноеПоле<font color=red>.</font>ВысотаПодвала <font color=red>= </font><font color=black>1</font><font color=red>;<br>
</font>ТабличноеПоле<font color=red>.</font>ВысотаШапки <font color=red>= </font><font color=black>1</font><font color=red>;<br>
</font>ТабличноеПоле<font color=red>.</font>ГоризонтальнаяПолосаПрокрутки <font color=red>= </font>ИспользованиеПолосыПрокрутки<font color=red>.</font>Использоватьавтоматически<font color=red>;<br>
</font>ТабличноеПоле<font color=red>.</font>ГоризонтальныеЛинии <font color=red>= Истина;<br>
</font>ТабличноеПоле<font color=red>.</font>ПорядокОтображения <font color=red>= </font><font color=black>1</font><font color=red>;<br>
</font>ТабличноеПоле<font color=red>.</font>УстановитьПривязку<font color=red>(</font>ГраницаЭлементаУправления<font color=red>.</font>Низ<font color=red>,</font>ЭтаФорма<font color=red>.</font>Панель<font color=red>,</font>ГраницаЭлементаУправления<font color=red>.</font>Низ<font color=red>);<br>
</font>ТабличноеПоле<font color=red>.</font>УстановитьПривязку<font color=red>(</font>ГраницаЭлементаУправления<font color=red>.</font>Право<font color=red>,</font>ЭтаФорма<font color=red>.</font>Панель<font color=red>,</font>ГраницаЭлементаУправления<font color=red>.</font>Право<font color=red>);<br>
</font>ТабличноеПоле<font color=red>.</font>ТолькоПросмотр <font color=red>= Ложь;</font></p></pre>
&nbsp;&nbsp;&nbsp;&nbsp;Но тут есть один нюанс, переписывать параметры руками, это просто жесть, всегда можно, что то забыть, не учесть,
не заметить, да и не всегда удается угадать какой контрол, какой содержит элемент управления, но тут падам!
К нам на выручку спешит чудесная штука ДекомпиляцияИАнализФорм_4.epf делаем формочку, настраиваем поведение, размеры, стили и прочие нужности,
скармливаем обработке, она генерит нам нужный код, очень приятная вешь, про автора известно что это (MRAK) Роман Ершов, больше я про него ничего не знаю,
он пожелал не раскрывать деталей. Собственно на этом все а кому нужно, может скачать
<a href="https://googledrive.com/host/0BxFnXEinPWUJckpLWkVCVjc0dUU/ДекомпиляцияИАнализФорм_4.epf">обработку</a> которая поможет вам в нелегких буднях 1сника.</p>
]]></description>
            <link>http://localhost:9778/posts/003_elements_on_form</link>
            <guid isPermaLink="true">http://localhost:9778/posts/003_elements_on_form</guid>
            <pubDate>Thu, 06 Sep 2012 14:13:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Хранение остатков поставщика у себя в базе]]></title>
            <description><![CDATA[<p>Заказчиком было поставлено условие: изменение конфигурации, должно быть обоснованным и не происходить без надобности. Были найдены и рассмотрены следующие варианты:</p>
<ol>
<li>Добавление регистра в базу. Загрузка туда остатков, да и вообще всего что можно загрузить.</li>
<li>Загрузка данных из экселя (Именно в этом формате поставщик хранит свои данные) каждый раз при открытии подбора в документ отгрузки.</li>
<li>Создание нового склада, и загрузка данных туда корректирующим документом.</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Первые два способа подразумевают модификацию обработки подбора в документ реализации  а один из них еще и добавление регистра, что само по себе не страшно конечно, но для заказчика не желательно. А во втором случае, надо каждый раз читать эксель, что тоже не очень хорошо. После <a href="http://www.forum.mista.ru/topic.php?id=619127">консультаций с комьюнити</a>, было выяснено, что вроде как все считают, что хранить  остатки у себя в базе нельзя, но почему, никто сказать не может. Решили остановиться на третьем варианте.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;И так что мы будем делать:</p>
<ol>
<li>Загрузим из подсунутого экселя остатки поставщика</li>
<li>Подсчитаем дельту, на которую надо скорректировать остатки.</li>
<li>Создадим документ «КоорректировкаЗаписейРегистраНакопления» и в него зальем движения.</li>
</ol>
<p>И так: Читаем эксель в таблицу значений.</p>
<pre><p><font color=red>Функция </font>ПрочитатьЭксель<font color=red>()<br>
&nbsp; &nbsp; </font>КСАртикул <font color=red>= Новый </font>КвалификаторыСтроки<font color=red>(</font><font color=black>25</font><font color=red>);<br>
&nbsp; &nbsp; </font>Массив <font color=red>= Новый </font>Массив<font color=red>;<br>
&nbsp; &nbsp; </font>Массив<font color=red>.</font>Добавить<font color=red>(</font>Тип<font color=red>(</font><font color=black>"Строка"</font><font color=red>));<br>
&nbsp; &nbsp; </font>ОписаниеТиповАртикул <font color=red>= Новый </font>ОписаниеТипов<font color=red>(</font>Массив<font color=red>, , </font>КСАртикул<font color=red>);<br>
<br>
&nbsp; &nbsp; </font>Массив<font color=red>.</font>Очистить<font color=red>();<br>
&nbsp; &nbsp; </font>КЧ <font color=red>= Новый </font>КвалификаторыЧисла<font color=red>(</font><font color=black>10</font><font color=red>);<br>
&nbsp; &nbsp; </font>Массив<font color=red>.</font>Добавить<font color=red>(</font>Тип<font color=red>(</font><font color=black>"Число"</font><font color=red>));<br>
&nbsp; &nbsp; </font>ОписаниеТиповЧ <font color=red>= Новый </font>ОписаниеТипов<font color=red>(</font>Массив<font color=red>, , ,</font>КЧ<font color=red>);<br>
<br>
&nbsp; &nbsp; </font>ТЗ <font color=red>= Новый </font>ТаблицаЗначений<font color=red>;<br>
&nbsp; &nbsp; </font>ТЗ<font color=red>.</font>Колонки<font color=red>.</font>Добавить<font color=red>(</font><font color=black>"Артикул"</font><font color=red>, </font>ОписаниеТиповАртикул<font color=red>);<br>
&nbsp; &nbsp; </font>ТЗ<font color=red>.</font>Колонки<font color=red>.</font>Добавить<font color=red>(</font><font color=black>"Количество"</font><font color=red>, </font>ОписаниеТиповЧ<font color=red>);<br>
<br>
&nbsp; &nbsp; Попытка<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Excel <font color=red>= Новый </font>COMОбъект<font color=red>(</font><font color=black>"Excel.Application"</font><font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font><font color=green>//Excel.WorkBooks.Open("D:\Базы\НомеенклатураРулевойОбрезан.xls");<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Excel<font color=red>.</font>WorkBooks<font color=red>.</font>Open<font color=red>(</font>ИмяФайла<font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Состояние<font color=red>(</font><font color=black>"Обработка файла Microsoft Excel"</font><font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ExcelЛист <font color=red>= </font>Excel<font color=red>.</font>Sheets<font color=red>(</font><font color=black>1</font><font color=red>);<br>
&nbsp; &nbsp; Исключение<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Сообщить<font color=red>(</font><font color=black>"Не удалось обработать файл!"</font><font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; Возврат </font><font color=black>""</font><font color=red>;<br>
&nbsp; &nbsp; КонецПопытки;<br>
<br>
&nbsp; &nbsp; Для </font>СтрокаЭксель <font color=red>= </font>СтрокаНачало <font color=red>По </font>СтрокаОкончание <font color=red>Цикл<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Прогресс <font color=red>= (</font>СтрокаЭксель <font color=red>/ </font>СтрокаОкончание<font color=red>) * </font><font color=black>100</font><font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>ЭлементыФормы<font color=red>.</font>СтрокаСтатуса<font color=red>.</font>Заголовок <font color=red>= </font><font color=black>"Считывается эксель в память " </font><font color=red>+ </font>СтрокаЭксель <font color=red>+ </font><font color=black>" из " </font><font color=red>+ </font>СтрокаОкончание<font color=red>;<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Зн <font color=red>= </font>ExcelЛист<font color=red>.</font>Cells<font color=red>(</font>СтрокаЭксель<font color=red>, </font>КолонкаАртикул<font color=red>).</font>Text<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>АртикулВДокумент <font color=red>= </font>СокрЛ<font color=red>(</font>ExcelЛист<font color=red>.</font>Cells<font color=red>(</font>СтрокаЭксель<font color=red>, </font>КолонкаАртикул<font color=red>).</font>Text<font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>КолвоВДокумент <font color=red>= </font>СокрЛ<font color=red>(</font>ExcelЛист<font color=red>.</font>Cells<font color=red>(</font>СтрокаЭксель<font color=red>, </font>КолонкаКоличество<font color=red>).</font>Text<font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>КолвоВДокумент <font color=red>= ?(</font>КолвоВДокумент <font color=red>= </font><font color=black>""</font><font color=red>, </font><font color=black>0</font><font color=red>, </font>Число<font color=red>(</font>КолвоВДокумент<font color=red>));<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>НоваяСтрокаТЗ <font color=red>= </font>ТЗ<font color=red>.</font>Добавить<font color=red>();<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>НоваяСтрокаТЗ<font color=red>.</font>Артикул <font color=red>= </font>АртикулВДокумент<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>НоваяСтрокаТЗ<font color=red>.</font>Количество <font color=red>= </font>КолвоВДокумент<font color=red>;<br>
&nbsp; &nbsp; КонецЦикла;<br>
<br>
&nbsp; &nbsp; </font>Excel<font color=red>.</font>WorkBooks<font color=red>.</font>Close<font color=red>();<br>
&nbsp; &nbsp; </font>Excel <font color=red>= </font><font color=black>0</font><font color=red>;<br>
&nbsp; &nbsp; Возврат </font>ТЗ<font color=red>;<br>
<br>
КонецФункции </font><font color=green>// ПрочитатьЭксель()</font></p></pre>
&nbsp;&nbsp;&nbsp;&nbsp;Я читаю эксель в типизизрованную таблицу значений, потому что для обработки таблицы запросом она должна быть типизирована. На форме есть надпись с названием "СтрокаСтатуса" которая рассказывает про текущий ход загрузки данных из экселя. Так же есть поля ввода в которых лежат номера колонок где артикул номенклатуры а где количество. Здесь вроде все настолько просто, что даже не знаю что тут прокомментировать. Ну раз с первым моментом нам все ясно, перейдем к вычислению дельты которую надо грузить в регистр. Для начала, что бы обращаться к этой таблице в запросе, надо ее поместить во временную таблицу, это не очень сложно и делается с помощью вот такого кода:
<pre><p>ТЗЭксель <font color=red>= </font>ПрочитатьЭксель<font color=red>();<br>
<br>
</font>МВТ <font color=red>= Новый </font>МенеджерВременныхТаблиц<font color=red>;<br>
</font>ТаблицаЭксель <font color=red>= Новый </font>Запрос<font color=red>;<br>
</font>ТаблицаЭксель<font color=red>.</font>МенеджерВременныхТаблиц <font color=red>= </font>МВТ<font color=red>;<br>
</font>ТаблицаЭксель<font color=red>.</font>Текст <font color=red>=<br>
&nbsp; &nbsp; </font><font color=black>"Выбрать<br>
&nbsp; &nbsp; |&nbsp;&nbsp; *<br>
&nbsp; &nbsp; |ПОМЕСТИТЬ ДокЭксель<br>
&nbsp; &nbsp; |ИЗ<br>
&nbsp; &nbsp; |&ТаблицаСДанными КАК Таблица"</font><font color=red>;<br>
</font>ТаблицаЭксель<font color=red>.</font>УстановитьПараметр<font color=red>(</font><font color=black>"ТаблицаСДанными"</font><font color=red>, </font>ТЗЭксель<font color=red>);<br>
</font>ТаблицаЭксель<font color=red>.</font>Выполнить<font color=red>();</font></p></pre>
Таблица есть, теперь перейдем к загрузке. Так как в экселе могут быть уже существующие записи или не быть тех которые есть в регистре, мы будем привязываться к справочнику номенклатура. Собственно вот он запрос:
<pre><p style="text-align: left; font-family: courier new,courier; color: black">
<font color=blue>ВЫБРАТЬ<br>
&nbsp; &nbsp; </font><font color=brown>ЕСТЬNULL</font><font color=blue>(</font>ТоварыНаСкладахОстатки.КоличествоОстаток<font color=blue>, </font><font color=#ff00ff>0</font><font color=blue>) КАК </font>ОстатокНаСкладе<font color=blue>,<br>
&nbsp; &nbsp; </font><font color=brown>ЕСТЬNULL</font><font color=blue>(</font>ДокЭксель.Количество<font color=blue>, </font><font color=#ff00ff>0</font><font color=blue>) КАК </font>КоличествоЭксель<font color=blue>,<br>
&nbsp; &nbsp; </font><font color=brown>ВЫБОР<br>
&nbsp; &nbsp; &nbsp; &nbsp; КОГДА ЕСТЬNULL</font><font color=blue>(</font>ДокЭксель.Количество<font color=blue>, </font><font color=#ff00ff>0</font><font color=blue>) - </font><font color=brown>ЕСТЬNULL</font><font color=blue>(</font>ТоварыНаСкладахОстатки.КоличествоОстаток<font color=blue>, </font><font color=#ff00ff>0</font><font color=blue>) < </font><font color=#ff00ff>0<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font><font color=brown>ТОГДА </font><font color=#ff00ff>0 </font><font color=blue>- (</font><font color=brown>ЕСТЬNULL</font><font color=blue>(</font>ДокЭксель.Количество<font color=blue>, </font><font color=#ff00ff>0</font><font color=blue>) - </font><font color=brown>ЕСТЬNULL</font><font color=blue>(</font>ТоварыНаСкладахОстатки.КоличествоОстаток<font color=blue>, </font><font color=#ff00ff>0</font><font color=blue>))<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font><font color=brown>ИНАЧЕ ЕСТЬNULL</font><font color=blue>(</font>ДокЭксель.Количество<font color=blue>, </font><font color=#ff00ff>0</font><font color=blue>) - </font><font color=brown>ЕСТЬNULL</font><font color=blue>(</font>ТоварыНаСкладахОстатки.КоличествоОстаток<font color=blue>, </font><font color=#ff00ff>0</font><font color=blue>)<br>
&nbsp; &nbsp; </font><font color=brown>КОНЕЦ </font><font color=blue>КАК </font><font color=brown>Количество</font><font color=blue>,<br>
&nbsp; &nbsp; </font><font color=#008b8b>&Склад</font><font color=blue>,<br>
&nbsp; &nbsp; </font>Товар.<font color=brown>Ссылка </font><font color=blue>КАК </font>Номенклатура<font color=blue>,<br>
&nbsp; &nbsp; </font><font color=brown>ЗНАЧЕНИЕ</font><font color=blue>(</font>Справочник.Качество.Новый<font color=blue>) КАК </font>Качество<font color=blue>,<br>
&nbsp; &nbsp; </font><font color=brown>ВЫБОР<br>
&nbsp; &nbsp; &nbsp; &nbsp; КОГДА ЕСТЬNULL</font><font color=blue>(</font>ДокЭксель.Количество<font color=blue>, </font><font color=#ff00ff>0</font><font color=blue>) - </font><font color=brown>ЕСТЬNULL</font><font color=blue>(</font>ТоварыНаСкладахОстатки.КоличествоОстаток<font color=blue>, </font><font color=#ff00ff>0</font><font color=blue>) > </font><font color=#ff00ff>0<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font><font color=brown>ТОГДА ЗНАЧЕНИЕ</font><font color=blue>(</font>ВидДвиженияНакопления.Приход<font color=blue>)<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font><font color=brown>ИНАЧЕ ЗНАЧЕНИЕ</font><font color=blue>(</font>ВидДвиженияНакопления.Расход<font color=blue>)<br>
&nbsp; &nbsp; </font><font color=brown>КОНЕЦ </font><font color=blue>КАК </font>ВидДвижения<font color=blue>,<br>
&nbsp; &nbsp; </font><font color=brown>ИСТИНА </font><font color=blue>КАК </font>Активность<font color=blue>,<br>
&nbsp; &nbsp; </font><font color=#008b8b>&Период</font><font color=blue>,<br>
&nbsp; &nbsp; </font><font color=#008b8b>&Док </font><font color=blue>КАК </font>Регистратор<br>
<font color=blue>ИЗ<br>
&nbsp; &nbsp; </font>Справочник.Номенклатура <font color=blue>КАК </font>Товар<br>
&nbsp; &nbsp; &nbsp; &nbsp; <font color=blue>ЛЕВОЕ СОЕДИНЕНИЕ </font>РегистрНакопления.ТоварыНаСкладах.Остатки<font color=blue>(, </font>Склад <font color=blue>= </font><font color=#008b8b>&Склад</font><font color=blue>) КАК </font>ТоварыНаСкладахОстатки<br>
&nbsp; &nbsp; &nbsp; &nbsp; <font color=blue>ПО </font>Товар.<font color=brown>Ссылка </font><font color=blue>= </font>ТоварыНаСкладахОстатки.Номенклатура<br>
&nbsp; &nbsp; &nbsp; &nbsp; <font color=blue>ЛЕВОЕ СОЕДИНЕНИЕ </font>ДокЭксель <font color=blue>КАК </font>ДокЭксель<br>
&nbsp; &nbsp; &nbsp; &nbsp; <font color=blue>ПО </font>Товар.Артикул <font color=blue>= </font>ДокЭксель.Артикул<br>
<font color=blue>ГДЕ<br>
&nbsp; &nbsp; </font>Товар.Артикул <font color=blue><> </font><font color=red>""</font></p></pre>
Не забываем, что для того что бы обратиться к временной таблице, нам надо указать менеджер временных таблиц:
<pre><p>Запрос<font color=red>.</font>МенеджерВременныхТаблиц <font color=red>= </font>МВТ<font color=red>;</font></p></pre>

<p><code>ЕСТЬNULL</code> нам гарантирует возврат числа в случае работы соединений, разницу мы получаем в строках с 4 по 8, строки с 9й по 19ю формируют значения для загрузки данных в регистр, собственно все почти готово. Осталось выгрузить результат в таблицу и удалить те значения которые грузить не надо(количество = 0) :</p>
<p><pre><p>ДвиженияВДокумент <font color=red>= </font>Запрос<font color=red>.</font>Выполнить<font color=red>().</font>Выгрузить<font color=red>();</font><font color=green>//&quot;Склад,Номенклатура,Качество,Количество&quot;<br>
</font>НулевыеДвижения <font color=red>= </font>ДвиженияВДокумент<font color=red>.</font>НайтиСтроки<font color=red>(Новый </font>Структура<font color=red>(</font><font color=black>&quot;Количество&quot;</font><font color=red>,</font><font color=black>0</font><font color=red>));<br>
Для Каждого </font>СтрокаТаблицы <font color=red>Из </font>НулевыеДвижения <font color=red>Цикл<br>
&nbsp; &nbsp; </font>ДвиженияВДокумент<font color=red>.</font>Удалить<font color=red>(</font>СтрокаТаблицы<font color=red>);<br>
КонецЦикла;</font></p></pre>
Создать документ корректировки и добавить строку в ТЧ которая укажет на регистр, это нужно для отображения документа и обеспечения возможности его редактировать.</p>
<p><pre><p>НовыйДок <font color=red>= </font>Документы<font color=red>.</font>КорректировкаЗаписейРегистров<font color=red>.</font>СоздатьДокумент<font color=red>();<br>
</font>НовыйДок<font color=red>.</font>Дата <font color=red>= </font>ТекущаяДата<font color=red>();<br>
</font>СтрокаТЧ <font color=red>= </font>НовыйДок<font color=red>.</font>ТаблицаРегистровНакопления<font color=red>.</font>Добавить<font color=red>();<br>
</font>СтрокаТЧ<font color=red>.</font>Имя <font color=red>= </font><font color=black>&quot;ТоварыНаСкладах&quot;</font><font color=red>;<br>
</font>СтрокаТЧ<font color=red>.</font>Представление <font color=red>= </font><font color=black>&quot;Товары на складах&quot;</font><font color=red>;<br>
</font>НовыйДок<font color=red>.</font>Записать<font color=red>();<br>
</font>НовыйДок <font color=red>= </font>НовыйДок<font color=red>.</font>Ссылка<font color=red>;<br>
</font></p></pre>
И собственно загрузить данные в регистр</p>
<p><pre><p>НаборВРегистр <font color=red>= </font>РегистрыНакопления<font color=red>.</font>ТоварыНаСкладах<font color=red>.</font>СоздатьНаборЗаписей<font color=red>();<br>
</font>НаборВРегистр<font color=red>.</font>Отбор<font color=red>.</font>Регистратор<font color=red>.</font>Значение <font color=red>= </font>НовыйДок<font color=red>;<br>
</font>НаборВРегистр<font color=red>.</font>Загрузить<font color=red>(</font>ДвиженияВДокумент<font color=red>.</font>Скопировать<font color=red>(,</font><font color=black>&quot;Период,Регистратор,Активность,ВидДвижения,Склад,Номенклатура,Качество,Количество&quot;</font><font color=red>));<br>
</font>НаборВРегистр<font color=red>.</font>Записать<font color=red>();<br>
</font></p></pre>
&nbsp;&nbsp;&nbsp;&nbsp;Как вы могли заметить документ мы уже не трогаем, его не надо, не записывать, не проводить, он просто является основанием для записи в регистр.
Собственно на этом все, внимательный читатель наверняка уже нашел ошибку а вы? ;)
Как обычно для тех кто дочитал или прокрутил до конца как обычно бонус: <a href="https://googledrive.com/host/0BxFnXEinPWUJckpLWkVCVjc0dUU/ЗагрузкаВНовыйСклад.epf">Обработка про которую я рассказывал в этом посте.</a></p>
]]></description>
            <link>http://localhost:9778/posts/002_storage_of_residues</link>
            <guid isPermaLink="true">http://localhost:9778/posts/002_storage_of_residues</guid>
            <pubDate>Thu, 06 Sep 2012 05:47:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Основные моменты при работе с СКД]]></title>
            <description><![CDATA[<h2 id="-">Как использовать параметры в СКД?</h2>
<p>При написании отчета для СКД иногда возникает потребность в использовании параметров, какие есть варианты? Для начала надо определиться что для того что бы параметры стали доступными, необходимо поставить галочку в схеме вот здесь:
<img src="http://i.imgur.com/zJHEInG.png" alt="Доступность параметра"></p>
<ol>
<li>Тыкнуть по кнопочке настройки, и задать настройки на стандартной форме. Мы этот вариант даже рассматривать не будем, по той простой причине, что их видно на стандартной форме невооруженным глазом, достаточно тыкнуть на кнопку... Настройки конечно же.</li>
<li>Сделать таблицу на форме и указать у нее источник.</li>
<li>Добавить на форму отчета поля ввода и прописать изменение параметров СКД при их изменении</li>
</ol>
<p>Рассмотрим  все варианты по подробнее.</p>
<h3 id="2-">2. Вывод всех прописанных настроек в одной таблице</h3>
<p>Это делается очень просто, добавляется таблица значений на форму а источником данных нужно указать: ОтчетОбъект -&gt; КомпоновщикНастроек -&gt; Настройки -&gt; Параметры данных.</p>
<h3 id="3-">3. Вынесение параметров отчета на форму, как правило самый нужный и удобный метод установки параметров.</h3>
<p>Для этого создадим форму отчета, если вы ее еще не создали (куда то, нам надо вынести параметры которые мы будем передавать в СКД) и добавим поле ввода нужного нам типа. И в событии &quot;ПриИзменении&quot; укажем следующий код:</p>
<p><pre><p>Параметры <font color=red>= </font>КомпоновщикНастроек<font color=red>.</font>Настройки<font color=red>.</font>ПараметрыДанных<font color=red>;<br>
</font>Параметр <font color=red>= </font>Параметры<font color=red>.</font>НайтиЗначениеПараметра<font color=red>(Новый </font>ПараметрКомпоновкиДанных<font color=red>(</font><font color=black>&quot;ПараметрУказанныйВЗапросе&quot;</font><font color=red>));<br>
Если </font>Параметр <font color=red>&lt;&gt; Неопределено Тогда<br>
&nbsp; &nbsp; </font>Параметр<font color=red>.</font>Значение <font color=red>= </font>ЗначениеКотороеМыХотимУстановить<font color=red>;<br>
&nbsp; &nbsp; </font>Параметр<font color=red>.</font>Использование <font color=red>= Истина;<br>
КонецЕсли;</font></p></pre>
Готово! Теперь при изменении элемента на форме параметр будет автоматически загружаться в СКД.</p>
<h2 id="-">Использование нескольких схем</h2>
<p>Периодически бывает что один отчет должен показывать вроде бы одну и ту же информацию но в разрезе разных показателей. И вроде отчет тот же, только сменился тип аналитики, или убрали колонку, которая участвовала в расчетах, но &quot;почти&quot; это для пользователя, для разработчика это уже другой набор полей и уже скорее всего структура другая, вообщем необходимо делать другой отчет, но можно просто использовать несколько схем и переключаться между ними по мере надобности. Переключаться между схемами несложно, достаточно сделать кнопочку повешать на нее следующую процедуру:</p>
<p><pre><p><font color=red>Процедура </font>СменитьСхему<font color=red>()<br>
&nbsp; &nbsp; </font>СхемаКомпоновкиДанных <font color=red>= </font>ПолучитьМакет<font color=red>(</font><font color=black>&quot;ЗдесьНадоУказатьИмяСхемы&quot;</font><font color=red>);<br>
&nbsp; &nbsp; </font>Настройки <font color=red>= </font>СхемаКомпоновкиДанных<font color=red>.</font>НастройкиПоУмолчанию<font color=red>;<br>
&nbsp; &nbsp; </font>КомпоновщикНастроек<font color=red>.</font>ЗагрузитьНастройки<font color=red>(</font>Настройки<font color=red>);<br>
КонецПроцедуры</font></p></pre>
Как видите, все просто, при желании можно сократить до двух строк или даже одной, но не уверен, что это пойдет на пользу читаемости кода. Но тут есть свой нюанс, при загрузке новых настроек старые параметры сотрутся, что на самом деле логично, но нас такое положение дел совершенно не устраивает. Какой из этого есть выход? Я думаю надо перед сменой компоновки параметры, надо сохранить в какой то буфер, а потом их восстановить. Как получить\записать параметр я уже говорил выше и не буду на это останавливаться. Так как параметров как правило больше чем два, особенно если это сложный отчет, то неправильно будет, писать</p>
<p><pre><p>Параметр1 <font color=red>= </font>Параметры<font color=red>.</font>НайтиЗначениеПараметра<font color=red>(Новый </font>ПараметрКомпоновкиДанных<font color=red>(</font><font color=black>&quot;ПараметрИзЗапроса&quot;</font><font color=red>));<br>
</font>СохраненноеЗначение1 <font color=red>= </font>Параметр1<font color=red>.</font>Значение<font color=red>;<br>
<br>
</font>Параметр2 <font color=red>= </font>Параметры<font color=red>.</font>НайтиЗначениеПараметра<font color=red>(Новый </font>ПараметрКомпоновкиДанных<font color=red>(</font><font color=black>&quot;ПараметрИзЗапроса2&quot;</font><font color=red>));<br>
</font>СохраненноеЗначение2 <font color=red>= </font>Параметр2<font color=red>.</font>Значение<font color=red>;<br>
<br>
</font><font color=green>//смена схемы компоновки<br>
<br>
</font>Параметр1 <font color=red>= </font>Параметры<font color=red>.</font>НайтиЗначениеПараметра<font color=red>(Новый </font>ПараметрКомпоновкиДанных<font color=red>(</font><font color=black>&quot;ПараметрИзЗапроса&quot;</font><font color=red>));<br>
</font>Параметр1<font color=red>.</font>Значение <font color=red>= </font>СохраненноеЗначение1<font color=red>;<br>
</font>Параметр1<font color=red>.</font>Использование <font color=red>= Истина;<br>
<br>
</font>Параметр2 <font color=red>= </font>Параметры<font color=red>.</font>НайтиЗначениеПараметра<font color=red>(Новый </font>ПараметрКомпоновкиДанных<font color=red>(</font><font color=black>&quot;ПараметрИзЗапроса2&quot;</font><font color=red>));<br>
</font>Параметр2<font color=red>.</font>Значение <font color=red>= </font>СохраненноеЗначение2<font color=red>;<br>
</font>Параметр2<font color=red>.</font>Использование <font color=red>= Истина;<br>
</font><font color=green>//и тд</font></p></pre>
<em>Я надеюсь, что вы понимаете, что этот код написан для примера и не стоит использовать перемнные с именами &quot;СохраненноеЗначение1&quot;,&quot;СохраненноеЗначение2&quot;, но даже если не понимаете, все равно не используйте.</em>
Хочется оптимизировать вышеприведенный код, что бы просто указать: <code>СохраниСписокПараметров(&quot;ЗдесьСписокПараметров&quot;);</code> потом сменить схему и сделать <code>ВосстановиСписокПараметров(&quot;ЗдесьСписокПараметров&quot;);</code> Написанием этих процедур мы и займемся, для этого далее я напишу эти две процедуры, одна будет сохранять параметры в спецально для этого отведнную структуру, другая будет из нее восстанавливать параметры. Вот они обе:</p>
<p><pre><p><font color=red>Функция </font>СохранитьПараметры<font color=red>(</font>ИменаПараметров<font color=red>)<br>
&nbsp; &nbsp; </font>Параметры <font color=red>= </font>КомпоновщикНастроек<font color=red>.</font>Настройки<font color=red>.</font>ПараметрыДанных<font color=red>;<br>
&nbsp; &nbsp; </font>МассивСИменами <font color=red>= </font>ОбщегоНазначения<font color=red>.</font>РазложитьСтрокуВМассивПодстрок<font color=red>(</font>ИменаПараметров<font color=red>,</font><font color=black>&quot;,&quot;</font><font color=red>);<br>
&nbsp; &nbsp; </font>СтруктураДляПараметров <font color=red>= Новый </font>Структура<font color=red>;<br>
&nbsp; &nbsp; Для Каждого </font>ИмяПараметра <font color=red>Из </font>МассивСИменами <font color=red>Цикл<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Параметр <font color=red>= </font>Параметры<font color=red>.</font>НайтиЗначениеПараметра<font color=red>(Новый </font>ПараметрКомпоновкиДанных<font color=red>(</font>ИмяПараметра<font color=red>));<br>
&nbsp; &nbsp; &nbsp; &nbsp; Если </font>Параметр <font color=red>&lt;&gt; Неопределено Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураДляПараметров<font color=red>.</font>Вставить<font color=red>(</font>ИмяПараметра<font color=red>, </font>Параметр<font color=red>.</font>Значение<font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; КонецЕсли;<br>
&nbsp; &nbsp; КонецЦикла;<br>
<br>
&nbsp; &nbsp; Возврат </font>СтруктураДляПараметров<font color=red>;<br>
КонецФункции<br>
<br>
Процедура </font>ЗагрузитьПараметры<font color=red>(</font>СтруктураСПараметрами<font color=red>)<br>
&nbsp; &nbsp; </font>Параметры <font color=red>= </font>КомпоновщикНастроек<font color=red>.</font>Настройки<font color=red>.</font>ПараметрыДанных<font color=red>;<br>
&nbsp; &nbsp; Для Каждого </font>ТекущийПараметр <font color=red>Из </font>СтруктураСПараметрами <font color=red>Цикл<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Параметр <font color=red>= </font>Параметры<font color=red>.</font>НайтиЗначениеПараметра<font color=red>(Новый </font>ПараметрКомпоновкиДанных<font color=red>(</font>ТекущийПараметр<font color=red>.</font>Ключ<font color=red>));<br>
&nbsp; &nbsp; &nbsp; &nbsp; Если </font>Параметр <font color=red>&lt;&gt; Неопределено Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>Параметр<font color=red>.</font>Значение <font color=red>= </font>ТекущийПараметр<font color=red>.</font>Значение<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>Параметр<font color=red>.</font>Использование <font color=red>= Истина;<br>
&nbsp; &nbsp; &nbsp; &nbsp; КонецЕсли;<br>
&nbsp; &nbsp; КонецЦикла;<br>
КонецПроцедуры<br></font></p></pre>
Остановлюсь, что бы более подробно объяснить, что происходит. Функция СохранитьПараметры принимает на входе строку с именами тех параметров которые надо сохранить. Затем она находит по имени нужный параметр и сохраняет в структуру, которую возвращает по окончании перебора всех параметров полученых из строки. То же самое, только наоборот делает процедура загрузить, она принимает структуру и загружает из нее в СКД параметры. Далее надо собрать все вместе, выглядеть это будет примерно так:</p>
<p><pre><p></p>
<p><font color=red>Функция </font>СохранитьПараметры<font color=red>(</font>ИменаПараметров<font color=red>)<br>
&nbsp; &nbsp; </font>Параметры <font color=red>= </font>КомпоновщикНастроек<font color=red>.</font>Настройки<font color=red>.</font>ПараметрыДанных<font color=red>;<br>
&nbsp; &nbsp; </font>МассивСИменами <font color=red>= </font>ОбщегоНазначения<font color=red>.</font>РазложитьСтрокуВМассивПодстрок<font color=red>(</font>ИменаПараметров<font color=red>,</font><font color=black>&quot;,&quot;</font><font color=red>);<br>
&nbsp; &nbsp; </font>СтруктураДляПараметров <font color=red>= Новый </font>Структура<font color=red>;<br>
&nbsp; &nbsp; Для Каждого </font>ИмяПараметра <font color=red>Из </font>МассивСИменами <font color=red>Цикл<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Параметр <font color=red>= </font>Параметры<font color=red>.</font>НайтиЗначениеПараметра<font color=red>(Новый </font>ПараметрКомпоновкиДанных<font color=red>(</font>ИмяПараметра<font color=red>));<br>
&nbsp; &nbsp; &nbsp; &nbsp; Если </font>Параметр <font color=red>&lt;&gt; Неопределено Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>СтруктураДляПараметров<font color=red>.</font>Вставить<font color=red>(</font>ИмяПараметра<font color=red>, </font>Параметр<font color=red>.</font>Значение<font color=red>);<br>
&nbsp; &nbsp; &nbsp; &nbsp; КонецЕсли;<br>
&nbsp; &nbsp; КонецЦикла;<br>
<br>
Возврат </font>СтруктураДляПараметров<font color=red>;<br>
КонецФункции<br>
<br>
<br>
Процедура </font>ЗагрузитьПараметры<font color=red>(</font>СтруктураСПараметрами<font color=red>)<br>
&nbsp; &nbsp; </font>Параметры <font color=red>= </font>КомпоновщикНастроек<font color=red>.</font>Настройки<font color=red>.</font>ПараметрыДанных<font color=red>;<br>
&nbsp; &nbsp; Для Каждого </font>ТекущийПараметр <font color=red>Из </font>СтруктураСПараметрами <font color=red>Цикл<br>
&nbsp; &nbsp; &nbsp; &nbsp; </font>Параметр <font color=red>= </font>Параметры<font color=red>.</font>НайтиЗначениеПараметра<font color=red>(Новый </font>ПараметрКомпоновкиДанных<font color=red>(</font>ТекущийПараметр<font color=red>.</font>Ключ<font color=red>));<br>
&nbsp; &nbsp; &nbsp; &nbsp; Если </font>Параметр <font color=red>&lt;&gt; Неопределено Тогда<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>Параметр<font color=red>.</font>Значение <font color=red>= </font>ТекущийПараметр<font color=red>.</font>Значение<font color=red>;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </font>Параметр<font color=red>.</font>Использование <font color=red>= Истина;<br>
&nbsp; &nbsp; &nbsp; &nbsp; КонецЕсли;<br>
&nbsp; &nbsp; КонецЦикла;<br>
КонецПроцедуры<br>
<br>
<br>
Процедура </font>СменитьСхему<font color=red>()<br>
&nbsp; &nbsp; </font>СтруктураСНастройками <font color=red>= </font>СохранитьПараметры<font color=red>(</font><font color=black>&quot;Параметр1,Параметр2,Параметр3&quot;</font><font color=red>);<br>
&nbsp; &nbsp; </font>СхемаКомпоновкиДанных <font color=red>= </font>ПолучитьМакет<font color=red>(</font><font color=black>&quot;ЗдесьИмяНужнойВамСхемы&quot;</font><font color=red>);<br>
&nbsp; &nbsp; </font>Настройки <font color=red>= </font>СхемаКомпоновкиДанных<font color=red>.</font>НастройкиПоУмолчанию<font color=red>;<br>
&nbsp; &nbsp; </font>КомпоновщикНастроек<font color=red>.</font>ЗагрузитьНастройки<font color=red>(</font>Настройки<font color=red>);<br>
&nbsp; &nbsp; </font>ЗагрузитьПараметры<font color=red>(</font>СтруктураСНастройками<font color=red>);<br>
КонецПроцедуры</font></p></pre></p>
<h2 id="-">Вывод СКД в отчет</h2>
<p>Если вы создали форму отчета у СКД(то есть если у вас отчет и есть схема компоновки данных), то по умолчанию на кнопке &quot;Сформировать&quot; висит предустанновленная команда &quot;Сфрмировать&quot;, которая запустит текущую схему, но можно туда повесить свой обработчик, если нужно перед формированием сделать какие нибудь манипуляции, вот код который можно туда повесить:</p>
<p><pre><p>КомпоновщикМакета<font color=red>=Новый </font>КомпоновщикМакетаКомпоновкиДанных<font color=red>;<br>
</font>МакетКомпоновкиДанных<font color=red>=</font>КомпоновщикМакета<font color=red>.</font>Выполнить<font color=red>(</font>СхемаКомпоновкиДанных<font color=red>,</font>КомпоновщикНастроек<font color=red>.</font>Настройки<font color=red>,</font>ДанныеРасшифровки<font color=red>);<br>
</font>ПроцессорКомпоновкиДанных<font color=red>=Новый </font>ПроцессорКомпоновкиДанных<font color=red>;<br>
</font>ПроцессорКомпоновкиДанных<font color=red>.</font>Инициализировать<font color=red>(</font>МакетКомпоновкиДанных<font color=red>,,</font>ДанныеРасшифровки<font color=red>,Истина);<br>
</font>ПроцессорВывода<font color=red>=Новый </font>ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент<font color=red>;<br>
</font>ПроцессорВывода<font color=red>.</font>УстановитьДокумент<font color=red>(</font>ЭлементыФормы<font color=red>.</font>Результат<font color=red>);<br>
</font>ПроцессорВывода<font color=red>.</font>Вывести<font color=red>(</font>ПроцессорКомпоновкиДанных<font color=red>);</font></p></pre>
Если вы не понимаете, что вообще происходит, просто сделайте кнопку на форме, и засуньте в обработчик этот код, сразу станет понятно, что все просто и что в целом то даже процессом вывода можно управлять, например перед формированием отчета, можно установить заголовок, в зависимости от установленных параметров или свернуть группировки после формирования, или время там формирования засечь, всякое бывает. Также можно вывести разом, а можно построчно, посмотреть детали можно в синтаксис помощнике по адресу Общие объекты -&gt; Система компоновки данных -&gt; Работа с механизмом -&gt; ПроцессорВыводаРезультатаКомпоновкиДанных</p>
<h3 id="-">Установка в качестве параметра списка значений.</h3>
<p>Когда нужно использовать список значений, для параметра необходимо установить галочку &quot;Доступен список значений&quot; иначе, даже если на входе будет список, СКД все равно будет брать только первое значение, галочка вот здесь:
<img src="http://i.imgur.com/1ENucxo.png" alt="Параметр в списке">
С этой галочкой в штатном списке параметров СКД, вы бонусом получаете красивый и удобный список для подбора ваших значений.</p>
<h3 id="-">Вывод СКД в таблицу.</h3>
<p>Бывает нужен, если нужно проанализировать или что то сделать с результатами работы, что бы получить результат работы  СКД в таблицу значений или в дерево значений, вам поможет следующий код:</p>
<p><pre><p>КомпоновщикМакета<font color=red>=Новый </font>КомпоновщикМакетаКомпоновкиДанных<font color=red>;<br>
</font>МакетКомпоновкиДанных<font color=red>=</font>КомпоновщикМакета<font color=red>.</font>Выполнить<font color=red>(</font>СхемаКомпоновкиДанных<font color=red>,</font>КомпоновщикНастроек<font color=red>.</font>Настройки<font color=red>,,,</font>Тип<font color=red>(</font><font color=black>&quot;ГенераторМакетаКомпоновкиДанныхДляКоллекцииЗначений&quot;</font><font color=red>));<br>
</font>ПроцессорКомпоновкиДанных<font color=red>=Новый </font>ПроцессорКомпоновкиДанных<font color=red>;<br>
</font>ПроцессорКомпоновкиДанных<font color=red>.</font>Инициализировать<font color=red>(</font>МакетКомпоновкиДанных<font color=red>);<br>
<br>
</font>ТЗДляВывода <font color=red>= Новый </font>ТаблицаЗначений<font color=red>;</font><font color=green>//здесь может быть и дерево значений<br>
</font>ПроцессорВывода <font color=red>= Новый </font>ПроцессорВыводаРезультатаКомпоновкиДанныхВКоллекциюЗначений<font color=red>;<br>
</font>ПроцессорВывода<font color=red>.</font>УстановитьОбъект<font color=red>(</font>ТЗДляВывода<font color=red>);<br>
</font>ПроцессорВывода<font color=red>.</font>Вывести<font color=red>(</font>ПроцессорКомпоновкиДанных<font color=red>);</font></p>
</pre>
собственно здесь в ТЗДляВывода мы получаем результат формирования отчета. Собственно если не касаться непосредствнно самого СКД, то здесь описаны практически все моменты работы с формой отчета построенного на СКД.</p>
<h3 id="-">Бонусы</h3>
<p>Тому кто домучал до конца эту длинную повесть, пригодятся бонусы:
Курс от гилева про СКД, что бы не искать информацию про СКД, можно скачать <a href="http://www.spec8.ru/kurs-po-skd-besplatno">бесплатный курс по СКД</a>
Можно взять <a href="https://googledrive.com/host/0BxFnXEinPWUJckpLWkVCVjc0dUU/%D0%A8%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD.erf">шаблон, в котором есть все нужные для оформления фичи</a></p>
]]></description>
            <link>http://localhost:9778/posts/001_base_skd</link>
            <guid isPermaLink="true">http://localhost:9778/posts/001_base_skd</guid>
            <pubDate>Wed, 05 Sep 2012 11:09:00 GMT</pubDate>
        </item>
    </channel>
</rss>